scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI), alpha = 0.25, show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, colour = intervention_year), alpha = 0.25, show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, fill = intervention_year)) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
mutate(intervention_year = factor(intervention_year, levels = c(2099 = 2099, 2025 = 2025))) %>%
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
scale_colour_manual("", values = c("red", "blue")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
incr_art_HIV_inc %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == "2099", #2099 reduction is used as a baseline / no reduction
test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
ggplot(aes(year, mean, fill = "blue"), show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = "blue"), fill = "blue", alpha = 0.25, show.legend = F) +
geom_line(aes(colour = "blue"), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, lwd = 0.75, colour = 1) +
expand_limits(y=0)  + theme_classic() + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14))  +
scale_colour_manual(" ", values = c("blue"), labels = "No reduction") +
xlab(" ") +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020))
# example plot
plot_hiv_inc_from_summary(incr_art_HIV_inc, 2025, 80)
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
scale_colour_manual("", values = c("red", "blue")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_hline(0.90) +
geom_hline(0.95) _
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_hline(0.90) +
geom_hline(0.95) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_hline(aes(0.90)) +
geom_hline(aes(0.95)) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_hline(aes(yintercept = 0.90)) +
geom_hline(aes(yintercept =0.95)) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_hline(aes(yintercept = 0.90), lty = 3) +
geom_hline(aes(yintercept =0.95), lty = 3) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_hline(aes(yintercept = 0.95), lty = 3) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
View(art_coverage_summary)
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_hline(aes(yintercept = 0.78), lty = 3) +
geom_hline(aes(yintercept = 0.95), lty = 3) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
View(art_coverage_summary)
art_coverage_summary <- df %>% filter(
scenario == "intervention",
indicator == "ARTcoverageAdult",
test_reduction == 0,# can be changed to HIVinc15plus for all adults 15+
year >= 2020,                # start year of graph
year < 2100) %>% # final year is 2099 as the pitc reduction in 2099 is used as baseline or no reduction
group_by(year, intervention_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975), # all lines are means and shading is 95% CI
lower_CI = quantile(value, probs = 0.025))
art_coverage_summary %>%
filter(intervention_year == 2099 | intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = intervention_year),show.legend = F) +
geom_hline(aes(yintercept = 0.78), lty = 3) +
geom_hline(aes(yintercept = 0.95), lty = 3) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
View(art_coverage_summary)
art_coverage_summary <- df %>% filter(
indicator == "ARTcoverageAdult",
test_reduction == 0,# can be changed to HIVinc15plus for all adults 15+
year >= 2020,                # start year of graph
year < 2100) %>% # final year is 2099 as the pitc reduction in 2099 is used as baseline or no reduction
group_by(year, intervention_year, scenario) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975), # all lines are means and shading is 95% CI
lower_CI = quantile(value, probs = 0.025))
art_coverage_summary %>%
filter(intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = scenario),show.legend = F) +
geom_hline(aes(yintercept = 0.78), lty = 3) +
geom_hline(aes(yintercept = 0.95), lty = 3) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = scenario), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = scenario),show.legend = F) +
geom_hline(aes(yintercept = 0.78), lty = 3) +
geom_hline(aes(yintercept = 0.95), lty = 3) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = scenario), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = scenario),show.legend = F) +
geom_hline(aes(yintercept = 0.95), lty = 3) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)})) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
art_coverage_summary %>%
filter(intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = scenario), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = scenario),show.legend = F) +
geom_hline(aes(yintercept = 0.95), lty = 3) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults with HIV on ART (%)",
labels = (function(l) {round(l*1e2,2)}), breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9, 0.95, 1)) +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()
# example plot
plot_hiv_inc_from_summary(incr_art_HIV_inc, 2025, 20)
incr_art_HIV_inc %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == "2099", #2099 reduction is used as a baseline / no reduction
test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
ggplot(aes(year, mean, fill = "blue"), show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = "blue"), fill = "blue", alpha = 0.25, show.legend = F) +
geom_line(aes(colour = "blue"), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, lwd = 0.75, colour = 1) +
expand_limits(y=0)  + theme_classic() + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14))  +
scale_colour_manual(" ", values = c("blue"), labels = "No reduction") +
xlab(" ") +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020))
incr_art_HIV_inc %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == "2099", #2099 reduction is used as a baseline / no reduction
test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
ggplot(aes(year, mean, fill = "blue"), show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = "blue"), fill = "blue", alpha = 0.25, show.legend = F) +
geom_line(aes(colour = "blue"), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, lwd = 0.75, colour = 1) +
expand_limits(y=0)  + theme_classic() + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14))  +
scale_colour_manual(" ", values = c("blue"), labels = "No reduction") +
xlab("") +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020))
View(incr_art_HIV_inc)
# example plot
plot_hiv_inc_from_summary(incr_art_HIV_inc, 2025, 40)
# example plot
plot_hiv_inc_from_summary(incr_art_HIV_inc, 2025, 60)
# example plot
plot_hiv_inc_from_summary(incr_art_HIV_inc, 2025, 80)
# example plot
plot_hiv_inc_from_summary(incr_art_HIV_inc, 2025, 80)
# example plot
plot_hiv_inc_from_summary(incr_art_HIV_inc, 2025, 100)
fsw_condom_usage_decrease = 0.01 # this is amount that fsw condom usage decreases by each year
st_condom_usage_decrease = 0.10 # this is amount that st condom usage decreases by each year
lt_condom_usage_decrease = 0.10 # this is amount that the condom usage decreases by each year
condom_incr_years = NA # these are the year for which condom usage decreases
art_interrupt_incr = NA # this is amount that the art interruption rate decreases by each year
art_incr_years = NA # these are the year for which art interruption rate decreases
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
fsw_condom_usage_init = fsw_condom_usage_init,
st_condom_usage_init = st_condom_usage_init,
lt_condom_usage_init = lt_condom_usage_init,
fsw_condom_usage_decrease = 0,
st_condom_usage_decrease = 0,
lt_condom_usage_decrease = 0,
condom_incr_years = NA,
art_interrupt_init = art_interrupt_init,
art_interrupt_incr = NA,
art_incr_years = art_incr_years,
output_names = output_names,
base_rate_reduction = base_rate_reduction)
# for loop that changes testing rate at different years and saves outputs
for (percentage_value in sliding_scale_reduction){
base_rate_reduction <- percentage_value/100
print(base_rate_reduction)
for (intervention_year in intervention_years){
print(intervention_year)
one_scenario <- run_thembisa_scenario_prev_year(intervention_year,
fsw_condom_usage_decrease = fsw_condom_usage_decrease,
st_condom_usage_decrease = st_condom_usage_decrease,
lt_condom_usage_decrease = lt_condom_usage_decrease,
condom_incr_years = condom_incr_years,
condom_maintenance_years = condom_maintenance_years,
art_interrupt_incr = art_interrupt_incr,
art_incr_years = art_incr_years,
output_names,
base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, "_", percentage_value,".csv"),
row.names = FALSE)
}
}
# make a new data frame joining all results
df <- read_thembisa_results_sliding_scale(intervention_years, sliding_scale_reduction)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# calculate condom usage for total adults and fsw-client only
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
unique(df$test_reduction)
df$test_reduction <- 100 - as.numeric(as.character(df$test_reduction))
df$test_reduction <- 100 - as.numeric(as.character(df$test_reduction))
df$test_reduction <- 100 - as.numeric(as.character(df$test_reduction))
unique(df$test_reduction)
df$test_reduction <- as.factor(df$test_reduction)
df$intervention_year <- as.integer(df$intervention_year)
means_95_CI_2025 <- df %>% filter(
scenario == "intervention",
indicator == "HIVinc15to49", # can be changed to HIVinc15plus for all adults 15+
year >= 1990,                # start year of graph
year < 2100,
intervention_year == 2025) %>%
mutate(intervention_year == as.integer(intervention_year)) %>% # final year is 2099 as the pitc reduction in 2099 is used as baseline or no reduction
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975), # all lines are means and shading is 95% CI
lower_CI = quantile(value, probs = 0.025))
means_95_CI_2099 <- df %>% filter(
scenario == "intervention",
indicator == "HIVinc15to49", # can be changed to HIVinc15plus for all adults 15+
year >= 1990,                # start year of graph
year < 2100,
intervention_year == (2099)) %>%
mutate(intervention_year == as.integer(intervention_year)) %>% # final year is 2099 as the pitc reduction in 2099 is used as baseline or no reduction
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975), # all lines are means and shading is 95% CI
lower_CI = quantile(value, probs = 0.025))
HIV_incidence_means_95_CI <- list(means_95_CI_2025, means_95_CI_2099)
names(HIV_incidence_means_95_CI) <- c(2025, 2099)
red_condom_HIV_incidence_summary <- bind_rows(HIV_incidence_means_95_CI, .id = "intervention_year")
write_csv(incr_art_HIV_incidence_summary, "results/red_condom_HIV_incidence_summary.csv")
# example plot
plot_hiv_inc_from_summary(red_condom_HIV_incidence_summary, 2025, 100)
# example plot
plot_hiv_inc_from_summary(red_condom_HIV_incidence_summary, 2025, 0)
condom_usage_summary <- df %>% filter(
indicator == "CondomUsage",
test_reduction == 0,# can be changed to HIVinc15plus for all adults 15+
year >= 2020,                # start year of graph
year < 2100) %>% # final year is 2099 as the pitc reduction in 2099 is used as baseline or no reduction
group_by(year, intervention_year, scenario) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975), # all lines are means and shading is 95% CI
lower_CI = quantile(value, probs = 0.025))
View(condom_usage_summary)
condom_usage_summary %>%
filter(intervention_year == 2025) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(year, mean, group = scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = scenario), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = scenario),show.legend = F) +
geom_hline(aes(yintercept = 0.95), lty = 3) +
scale_colour_manual("", values = c("blue", "red")) +
scale_fill_manual("", values = c("blue", "red")) +
scale_y_continuous("Adults using condoms (%)") +
xlab(" ") + theme(axis.text = element_text(size = 12), axis.title.y = element_text(size = 14)) +
theme_classic()

art_interrupt_rate_decrease = NA,
art_incr_years = art_incr_years,
art_interrupt_rate_increase = art_interrupt_rate_increase,
art_decr_years = art_decr_years,
art_maintenance_years = art_maintenance_years,
output_names = output_names,
base_rate_reduction = base_rate_reduction)
# save baseline outputs
assign("baseline", baseline)
# create matrix for all pitc reduction years and reduction percentages
name_matrix <- expand_grid(pitc_reduction_years, pitc_reduction_percentage)
# combine each year with each percentage to create unique scenario names
scenario_names <- purrr::pmap_chr(name_matrix, paste, sep = "_")
# count scenario names
n_scenarios <- length(scenario_names)
# make a list with empty tibbles for each scenario
scenarios <- replicate(n_scenarios, tibble())
# for loop that changes testing rate at different years and saves outputs
# predefined condom reduction and art interruption rate changes are used
for (percentage_value in pitc_reduction_percentage){
base_rate_reduction <- percentage_value/100
for (year in pitc_reduction_years){
pitc_reduction_year <- year
one_scenario <- run_thembisa_scenario_prev_year(pitc_reduction_year = pitc_reduction_year,
condom_usage_reduction = condom_usage_reduction,
fsw_condom_usage_decrease = fsw_condom_usage_decrease,
st_condom_usage_decrease = st_condom_usage_decrease,
lt_condom_usage_decrease = lt_condom_usage_decrease,
condom_decr_years = condom_decr_years,
condom_usage_promotion = condom_usage_promotion,
fsw_condom_usage_increase = fsw_condom_usage_increase,
st_condom_usage_increase = st_condom_usage_increase,
lt_condom_usage_increase = lt_condom_usage_increase,
condom_incr_years = condom_incr_years,
condom_maintenance_years = condom_maintenance_years,
art_interrupt_rate_decrease = art_interrupt_rate_decrease,
art_incr_years = art_incr_years,
art_coverage_increase = art_coverage_increase,
art_coverage_decrease = art_coverage_decrease,
art_interrupt_rate_increase = art_interrupt_rate_increase,
art_decr_years = art_decr_years,
art_maintenance_years = art_maintenance_years,
output_names = output_names,
base_rate_reduction = base_rate_reduction)
name <- paste(year, percentage_value, sep = "_")
scenarios[[which(scenario_names == name)]] <- one_scenario # save df for one scenario
}
}
# make a new data frame joining all results
df <- read_thembisa_results_cluster(pitc_reduction_years, pitc_reduction_percentage,
scenarios = scenarios, scenario_names = scenario_names,
baseline = baseline)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
mutate(TotalAIDSdeaths = TotalAIDSdeathsadult + AIDSdeaths0 +
AIDSdeaths1to4 + AIDSdeaths5to9 + AIDSdeaths10to14) %>%
mutate(TestsPerAdult = TotalHIVtests / (MalesOver15 + FemalesOver15))%>%
mutate(TotalAdultsOnART = TotalART15F + TotalART15M) %>%
mutate(StartingART_15 = StartingART_M15 + StartingART_F15) %>%
mutate(Total2LAdultsOnART= TotalART15M2L + TotalART15F2L) %>%
mutate(Adult_1st_line_FU = TotalAdultsOnART - Total2LAdultsOnART - StartingART_15) %>%
mutate(ANCtestPos = RediagnosesPregnancy + NewDiagnosesPregnancy) %>%
mutate(ANCtestNeg = TotANCtests - ANCtestPos) %>%
mutate(FollowUpART1to2 = TotalART1to2 - StartingART1to2) %>%
mutate(FollowUpART3to5 = TotalART3to5 - StartingART3to5) %>%
mutate(FollowUpART6to9 = TotalART6to9 - StartingART6to9) %>%
mutate(FollowUpART10to14 = TotalART10to14 - StartingART10to14) %>%
select(-c(AIDSdeathsAdultF, AIDSdeathsAdultM, AIDSdeaths0,
AIDSdeaths1to4, AIDSdeaths5to9, AIDSdeaths10to14,
TotalART15F, TotalART15M,
StartingART_M15, StartingART_F15, TotalART15M2L, TotalART15F2L,
RediagnosesPregnancy, NewDiagnosesPregnancy, TotANCtests, TotalART1to2,
TotalART3to5, TotalART6to9, TotalART10to14)) %>%
pivot_longer(-(pitc_reduction_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(cost_art_adults_1st_line_1st_yr = StartingART_15 * 272.032122700937) %>%
mutate(cost_art_adults_1st_line_fu = Adult_1st_line_FU * 170.751611736494) %>%
mutate(cost_art_adults_2nd_line = Total2LAdultsOnART * 299.8747935152) %>%
mutate(cost_art_neonates = StartingART0 * 91.2391745089155) %>%
mutate(cost_art_kids_under_1 = StartingART1 * 285.916170708839) %>%
mutate(cost_art_kids_1to2 = StartingART1to2 * 381.539892940659) %>%
mutate(cost_art_kids_1to2_fu = FollowUpART1to2 * 311.447129366554) %>%
mutate(cost_art_kids_3to5 = StartingART3to5 * 441.97810423809) %>%
mutate(cost_art_kids_3to5_fu = FollowUpART3to5 * 371.885340663985) %>%
mutate(cost_art_kids_6to9 = StartingART6to9 * 327.476567703383) %>%
mutate(cost_art_kids_6to9_fu = FollowUpART6to9 * 257.383804129278) %>%
mutate(cost_art_kids_10to14 = StartingART10to14 * 263.072779455781) %>%
mutate(cost_art_kids_10to14_fu = FollowUpART10to14 * 192.980015881676) %>%
mutate(cost_general_hts_neg = (PaedsHIVtestsNeg + AdultHIVtestsNeg) * 3.62338764573665) %>%
mutate(cost_general_hts_pos = (PaedsHIVtestsPos + AdultHIVtestsPos) * 5.19545019977912) %>%
mutate(cost_anc_test_neg = ANCtestNeg * 3.16302881313226) %>%
mutate(cost_anc_test_pos = ANCtestPos * 4.71561496557645) %>%
mutate(cost_palliative_care = TotalAIDSdeaths * 65.4212024937027) %>%
mutate(cost_inpatient_art_under200 = (OnARTcurrUnder200) * 401.760069448105) %>%
mutate(cost_inpatient_art_200to349 = (OnARTcurr200to349) * 126.835600669276) %>%
mutate(cost_inpatient_art_350to499 = (OnARTcurr350to499) * 37.3981315846365) %>%
mutate(cost_inpatient_art_over500 = (OnARTcurrOver500) * 37.3981315846365) %>%
mutate(cost_inpatient_pre_art_under200 = (PreARTunder200M + PreARTunder200F + DiscARTunder200) * 156.388938508806) %>%
mutate(cost_inpatient_pre_art_200to349 = (PreART200to349M + PreART200to349F + DiscART200to349) * 83.870745576945) %>%
mutate(cost_inpatient_pre_art_350to499 = (PreART350to499M + PreART350to499F + DiscART350to499) * 46.8195688818689) %>%
mutate(cost_inpatient_pre_art_over500 = (PreARTover500M + PreARTover500F + DiscARTover500) * 46.8195688818689) %>%
select(-c(Adult_1st_line_FU,Total2LAdultsOnART,StartingART0,StartingART1to2,
StartingART3to5, FollowUpART3to5, StartingART6to9, FollowUpART6to9,
StartingART10to14, FollowUpART10to14, AdultHIVtestsNeg, AdultHIVtestsPos,
PaedsHIVtestsNeg, PaedsHIVtestsPos,
ANCtestNeg, ANCtestPos, OnARTcurrUnder200, OnARTcurr200to349, OnARTcurr350to499, OnARTcurrOver500,
PreARTunder200M, PreARTunder200F, DiscARTunder200, PreART200to349M, PreART200to349F,
DiscART200to349, PreART350to499M, PreART350to499F, DiscART350to499, PreARTover500M,
PreARTover500F, DiscARTover500)) %>%
pivot_longer(-(pitc_reduction_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
group_by(parameter_set) %>%
mutate(cost_total_testing = cost_general_hts_neg +
cost_general_hts_pos +
cost_anc_test_neg +
cost_anc_test_pos) %>%
mutate(cost_total_treatment = cost_art_adults_1st_line_1st_yr +
cost_art_adults_1st_line_fu +
cost_art_adults_2nd_line +
cost_art_neonates +
cost_art_kids_under_1 +
cost_art_kids_1to2 +
cost_art_kids_1to2_fu +
cost_art_kids_3to5 +
cost_art_kids_3to5_fu +
cost_art_kids_6to9 +
cost_art_kids_6to9_fu +
cost_art_kids_10to14 +
cost_art_kids_10to14_fu) %>%
mutate(cost_total_care = cost_palliative_care +
cost_inpatient_art_under200 +
cost_inpatient_art_200to349 +
cost_inpatient_art_350to499 +
cost_inpatient_art_over500 +
cost_inpatient_pre_art_under200 +
cost_inpatient_pre_art_200to349 +
cost_inpatient_pre_art_350to499 +
cost_inpatient_pre_art_over500) %>%
mutate(cost_total = cost_total_testing + cost_total_treatment +
cost_total_care) %>%
pivot_longer(-(pitc_reduction_year:scenario), names_to = "indicator")
df$test_reduction <- 100 - as.integer(df$test_reduction)
# make test_reduction a factor
df$test_reduction <- as.factor(df$test_reduction)
df_3pct_disc <- df %>%
pivot_wider(names_from = year)
for (i in 46:121){
df_3pct_disc[,i] <- df_3pct_disc[,i]*(1-0.03)^(as.numeric(colnames(df_3pct_disc[,i]))- 2025)
}
df_3pct_disc <- df_3pct_disc %>%
pivot_longer(-(pitc_reduction_year:indicator), names_to = "year")
df_3pct_disc <- df_3pct_disc %>%
mutate(year = as.numeric(year)) %>%
relocate(year, .before = parameter_set)
df_6pct_disc <- df %>%
pivot_wider(names_from = year)
for (i in 46:121){
df_6pct_disc[,i] <- df_6pct_disc[,i]*(1-0.06)^(as.numeric(colnames(df_6pct_disc[,i]))- 2025)
}
df_6pct_disc <- df_6pct_disc %>%
pivot_longer(-(pitc_reduction_year:indicator), names_to = "year")
df_6pct_disc <- df_6pct_disc %>%
mutate(year = as.numeric(year)) %>%
relocate(year, .before = parameter_set)
df$discount <- "undiscounted"
df_3pct_disc$discount <- "3%"
df_6pct_disc$discount <- "6%"
df <- bind_rows(df, df_3pct_disc, df_6pct_disc)
df <- df %>%
relocate(discount, .before =  value)
df <- df %>%
pivot_wider(names_from = scenario) %>%
mutate(annual_percent_change = ((intervention - baseline)/baseline)*100) %>%
mutate(annual_absolute_dif = intervention - baseline) %>%
pivot_longer(-(pitc_reduction_year:discount), names_to = "scenario")
# saving a summary csv of all outputs
summary <- as.data.frame(df) %>%
dplyr::group_by(year, scenario, indicator, pitc_reduction_year, test_reduction, discount) %>%
dplyr::summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975, na.rm = TRUE),
lower_CI = quantile(value, probs = 0.025, na.rm = TRUE))  %>% mutate(future_variability = "test_reduction_only", future_value = 0)
if (condom_usage_reduction & !condom_usage_promotion & !art_coverage_increase & !art_coverage_decrease){
summary$future_variability <- "condom_reduction"
summary$future_value <- condom_usage_decrease
}
if (condom_usage_promotion & !condom_usage_reduction & !art_coverage_increase & !art_coverage_decrease){
summary$future_variability <- "condom_promotion"
summary$future_value <- condom_usage_increase
}
if (art_coverage_increase & !condom_usage_reduction & !condom_usage_promotion & !art_coverage_decrease){
summary$future_variability <-  "art_improvement"
summary$future_value <- art_interrupt_rate_decrease
}
if (art_coverage_decrease & !condom_usage_reduction & !condom_usage_promotion & !art_coverage_increase){
summary$future_variability <- "art_deterioration"
summary$future_value <- art_interrupt_rate_increase
}
write_csv(summary, paste0("results/", summary_name, ".csv"))
cumulative_summaries <- data.frame()
for (i in 1:length(cumulative_years_list)){
# cumulative values
cumulative_years <- cumulative_years_list[i]
df_shortened <- df %>% filter(scenario %in% c("intervention", "baseline"),
indicator %in% c("cost_total", "cost_total_care",
"cost_total_testing", "cost_total_treatment", "TestsPerAdult",
"NewAdultHIV", "TotalAIDSdeathsadult"))
cumulative_values <- calc_all_cumulatives(as.numeric(pitc_reduction_years),
cumulative_years, df = df_shortened)
# calculate elimination years and add to cumulative values
cumulative_values <- add_elimination_year_to_cumulative(cumulative_values, df_shortened)
# add cumulative year column
cumulative_values$cumulative_years <- cumulative_years
cumulative_values <- cumulative_values %>%
relocate(cumulative_years, .before = scenario)
# calculate cumulative percent change from baseline
cumulative_values <- cumulative_values %>%
pivot_wider(names_from = scenario, values_from = cumulative) %>%
mutate(percent_change = ((intervention - baseline)/baseline)*100) %>%
mutate(absolute_dif = intervention - baseline) %>%
pivot_longer(-(indicator:discount), names_to = "scenario")
# calculate percent of total cost
cumulative_values <- cumulative_values %>%
pivot_wider(names_from = indicator) %>%
mutate(percent_total_cost = (cost_total_testing / cost_total_testing)*100) %>%
pivot_longer(-(scenario:discount), names_to = "indicator")
# Calculating running cumulative totals
cumulative_summary <- cumulative_values %>%
group_by(indicator, pitc_reduction_year, test_reduction, scenario, discount) %>%
summarise(mean = mean(value), median = median(value), upper_CI = quantile(value, probs = 0.975, na.rm = TRUE),
lower_CI = quantile(value, probs = 0.025, na.rm = TRUE))
cumulative_summary <- cumulative_summary %>% mutate(future_variability = "test_reduction_only", future_value = 0)
if (condom_usage_reduction & !condom_usage_promotion & !art_coverage_increase & !art_coverage_decrease){
cumulative_summary$future_variability <- "condom_reduction"
cumulative_summary$future_value <- condom_usage_decrease
}
if (condom_usage_promotion & !condom_usage_reduction & !art_coverage_increase & !art_coverage_decrease){
cumulative_summary$future_variability <- "condom_promotion"
cumulative_summary$future_value <- condom_usage_increase
}
if (art_coverage_increase & !condom_usage_reduction & !condom_usage_promotion & !art_coverage_decrease){
cumulative_summary$future_variability <-  "art_improvement"
cumulative_summary$future_value <- art_interrupt_rate_decrease
}
if (art_coverage_decrease & !condom_usage_reduction & !condom_usage_promotion & !art_coverage_increase){
cumulative_summary$future_variability <- "art_deterioration"
cumulative_summary$future_value <- art_interrupt_rate_increase
}
cumulative_summary$cumulative_years <- cumulative_years
cumulative_summaries <- bind_rows(cumulative_summaries, cumulative_summary)
}
# cumulative values
cumulative_years <- cumulative_years_list[i]
df_shortened <- df %>% filter(scenario %in% c("intervention", "baseline"),
indicator %in% c("cost_total", "cost_total_care",
"cost_total_testing", "cost_total_treatment", "TestsPerAdult",
"NewAdultHIV", "TotalAIDSdeathsadult"))
cumulative_values <- calc_all_cumulatives(as.numeric(pitc_reduction_years),
cumulative_years, df = df_shortened)
cumulative_values <- add_elimination_year_to_cumulative(cumulative_values, df_shortened)
cumulative_values$cumulative_years <- cumulative_years
cumulative_values <- cumulative_values %>%
relocate(cumulative_years, .before = scenario)
cumulative_values <- cumulative_values %>%
pivot_wider(names_from = scenario, values_from = cumulative) %>%
mutate(percent_change = ((intervention - baseline)/baseline)*100) %>%
mutate(absolute_dif = intervention - baseline) %>%
pivot_longer(-(indicator:discount), names_to = "scenario")
View(cumulative_values)
View(cumulative_values)
# calculate percent of total cost
cumulative_values <- cumulative_values %>%
pivot_wider(names_from = indicator) %>%
mutate(percent_total_cost = (cost_total_testing / cost_total_testing)*100) %>%
pivot_longer(-(pitc_reduction_year:scenario), names_to = "indicator")
# Calculating running cumulative totals
cumulative_summary <- cumulative_values %>%
group_by(indicator, pitc_reduction_year, test_reduction, scenario, discount) %>%
summarise(mean = mean(value), median = median(value), upper_CI = quantile(value, probs = 0.975, na.rm = TRUE),
lower_CI = quantile(value, probs = 0.025, na.rm = TRUE))
cumulative_summary <- cumulative_summary %>% mutate(future_variability = "test_reduction_only", future_value = 0)
if (condom_usage_reduction & !condom_usage_promotion & !art_coverage_increase & !art_coverage_decrease){
cumulative_summary$future_variability <- "condom_reduction"
cumulative_summary$future_value <- condom_usage_decrease
}
if (condom_usage_promotion & !condom_usage_reduction & !art_coverage_increase & !art_coverage_decrease){
cumulative_summary$future_variability <- "condom_promotion"
cumulative_summary$future_value <- condom_usage_increase
}
if (art_coverage_increase & !condom_usage_reduction & !condom_usage_promotion & !art_coverage_decrease){
cumulative_summary$future_variability <-  "art_improvement"
cumulative_summary$future_value <- art_interrupt_rate_decrease
}
if (art_coverage_decrease & !condom_usage_reduction & !condom_usage_promotion & !art_coverage_increase){
cumulative_summary$future_variability <- "art_deterioration"
cumulative_summary$future_value <- art_interrupt_rate_increase
}
cumulative_summary$cumulative_years <- cumulative_years
cumulative_summaries <- bind_rows(cumulative_summaries, cumulative_summary)
write_csv(cumulative_summaries, paste0("results/cumulative_", summary_name, ".csv"))
cumulative_summaries <- data.frame()
for (i in 1:length(cumulative_years_list)){
# cumulative values
cumulative_years <- cumulative_years_list[i]
df_shortened <- df %>% filter(scenario %in% c("intervention", "baseline"),
indicator %in% c("cost_total", "cost_total_care",
"cost_total_testing", "cost_total_treatment", "TestsPerAdult",
"NewAdultHIV", "TotalAIDSdeathsadult"))
cumulative_values <- calc_all_cumulatives(as.numeric(pitc_reduction_years),
cumulative_years, df = df_shortened)
# calculate elimination years and add to cumulative values
cumulative_values <- add_elimination_year_to_cumulative(cumulative_values, df_shortened)
# add cumulative year column
cumulative_values$cumulative_years <- cumulative_years
cumulative_values <- cumulative_values %>%
relocate(cumulative_years, .before = scenario)
# calculate cumulative percent change from baseline
cumulative_values <- cumulative_values %>%
pivot_wider(names_from = scenario, values_from = cumulative) %>%
mutate(percent_change = ((intervention - baseline)/baseline)*100) %>%
mutate(absolute_dif = intervention - baseline) %>%
pivot_longer(-(indicator:discount), names_to = "scenario")
# calculate percent of total cost
cumulative_values <- cumulative_values %>%
pivot_wider(names_from = indicator) %>%
mutate(percent_total_cost = (cost_total_testing / cost_total_testing)*100) %>%
pivot_longer(-(pitc_reduction_year:scenario), names_to = "indicator")
# Calculating running cumulative totals
cumulative_summary <- cumulative_values %>%
group_by(indicator, pitc_reduction_year, test_reduction, scenario, discount) %>%
summarise(mean = mean(value), median = median(value), upper_CI = quantile(value, probs = 0.975, na.rm = TRUE),
lower_CI = quantile(value, probs = 0.025, na.rm = TRUE))
cumulative_summary <- cumulative_summary %>% mutate(future_variability = "test_reduction_only", future_value = 0)
if (condom_usage_reduction & !condom_usage_promotion & !art_coverage_increase & !art_coverage_decrease){
cumulative_summary$future_variability <- "condom_reduction"
cumulative_summary$future_value <- condom_usage_decrease
}
if (condom_usage_promotion & !condom_usage_reduction & !art_coverage_increase & !art_coverage_decrease){
cumulative_summary$future_variability <- "condom_promotion"
cumulative_summary$future_value <- condom_usage_increase
}
if (art_coverage_increase & !condom_usage_reduction & !condom_usage_promotion & !art_coverage_decrease){
cumulative_summary$future_variability <-  "art_improvement"
cumulative_summary$future_value <- art_interrupt_rate_decrease
}
if (art_coverage_decrease & !condom_usage_reduction & !condom_usage_promotion & !art_coverage_increase){
cumulative_summary$future_variability <- "art_deterioration"
cumulative_summary$future_value <- art_interrupt_rate_increase
}
cumulative_summary$cumulative_years <- cumulative_years
cumulative_summaries <- bind_rows(cumulative_summaries, cumulative_summary)
}
write_csv(cumulative_summaries, paste0("results/cumulative_", summary_name, ".csv"))
setwd("~/Documents/HIV_EndGame_SA/orderly/thembisa_orderly/src/thembisa")
source("R/cluster_function_orderly.R")
setwd("~/Documents/HIV_EndGame_SA/THEMBISAv18")
run_on_cluster(pitc_reduction_years = 2025,
pitc_reduction_percentage = c(0),
condom_usage_reduction = FALSE,
condom_usage_decrease = 0,
condom_decr_start = 2025,
condom_usage_promotion = FALSE,
condom_usage_increase = 0,
condom_incr_start = 2025,
art_coverage_increase = FALSE,
art_interrupt_rate_decrease = 0,
art_incr_start = 2025,
art_coverage_decrease = FALSE,
art_interrupt_rate_increase = 0,
art_decr_start = 2025,
cumulative_years_list = c(9, 49),
summary_name = "costs"
)
cumulative_costs <- read_csv("results/cumulative_costs.csv")
cumulative_costs$indicator == cost_cum_base
unique(cumulative_costs$indicator)
cumulative_costs$indicator == percent_total_cost
View(cumulative_costs)
setwd("~/Documents/HIV_EndGame_SA/orderly/thembisa_orderly/src/thembisa")
source("R/cluster_function_orderly.R")
setwd("~/Documents/HIV_EndGame_SA/THEMBISAv18")
run_on_cluster(pitc_reduction_years = 2025,
pitc_reduction_percentage = c(0),
condom_usage_reduction = FALSE,
condom_usage_decrease = 0,
condom_decr_start = 2025,
condom_usage_promotion = FALSE,
condom_usage_increase = 0,
condom_incr_start = 2025,
art_coverage_increase = FALSE,
art_interrupt_rate_decrease = 0,
art_incr_start = 2025,
art_coverage_decrease = FALSE,
art_interrupt_rate_increase = 0,
art_decr_start = 2025,
cumulative_years_list = c(9, 49),
summary_name = "costs"
)
cumulative_costs <- read_csv("results/cumulative_costs.csv")
View(cumulative_costs)
View(cumulative_summaries)
View(cumulative_values)
View(cumulative_summary)
cost_summary <- read_csv("results/costs.csv")
View(cost_summary)
is.na(cost_summary$discount)
sum(is.na(cost_summary$discount))
View(df_shortened)
sum(is.na(df_shortened$discount))
cumulative_values <- calc_all_cumulatives(as.numeric(pitc_reduction_years),
cumulative_years, df = df_shortened)
View(cumulative_values)
sum(is.na(cumulative_values))
sum(is.na(cumulative_values$discount))
cumulative_values <- add_elimination_year_to_cumulative(cumulative_values, df_shortened)
sum(is.na(cumulative_values$discount))
cumulative_values$cumulative_years <- cumulative_years
sum(is.na(cumulative_values$discount))
cumulative_values <- cumulative_values %>%
relocate(cumulative_years, .before = scenario)
sum(is.na(cumulative_values$discount))
cumulative_values <- cumulative_values %>%
pivot_wider(names_from = scenario, values_from = cumulative) %>%
mutate(percent_change = ((intervention - baseline)/baseline)*100) %>%
mutate(absolute_dif = intervention - baseline) %>%
pivot_longer(-(indicator:discount), names_to = "scenario")
sum(is.na(cumulative_values$discount))
is.na(cumulative_values$discount)
cumulative_values[is.na(cumulative_values$discount)]
cumulative_values[is.na(cumulative_values$discount),]
cumulative_values[is.na(cumulative_values$discount),]$discount
cumulative_values[is.na(cumulative_values$discount),]$discount <- "undiscounted"
sum(is.na(cumulative_values$discount))
setwd("~/Documents/HIV_EndGame_SA/orderly/thembisa_orderly/src/thembisa")
source("R/cluster_function_orderly.R")
setwd("~/Documents/HIV_EndGame_SA/THEMBISAv18")
run_on_cluster(pitc_reduction_years = 2025,
pitc_reduction_percentage = c(0),
condom_usage_reduction = FALSE,
condom_usage_decrease = 0,
condom_decr_start = 2025,
condom_usage_promotion = FALSE,
condom_usage_increase = 0,
condom_incr_start = 2025,
art_coverage_increase = FALSE,
art_interrupt_rate_decrease = 0,
art_incr_start = 2025,
art_coverage_decrease = FALSE,
art_interrupt_rate_increase = 0,
art_decr_start = 2025,
cumulative_years_list = c(9, 49),
summary_name = "costs"
)
cumulative_costs <- read_csv("results/cumulative_costs.csv")
View(cumulative_costs)
setwd("~/Documents/HIV_EndGame_SA/orderly/thembisa_orderly/src/thembisa")
source("R/cluster_function_orderly.R")
setwd("~/Documents/HIV_EndGame_SA/THEMBISAv18")
system("g++ -std=c++14 THEMBISA.cpp StatFunctions.cpp mersenne.cpp -o thembisa -O2")
run_on_cluster(pitc_reduction_years = 2025,
pitc_reduction_percentage = c(0, 25, 50, 75, 100),
condom_usage_reduction = FALSE,
condom_usage_decrease = 0,
condom_decr_start = 2025,
condom_usage_promotion = FALSE,
condom_usage_increase = 0,
condom_incr_start = 2025,
art_coverage_increase = FALSE,
art_interrupt_rate_decrease = 0,
art_incr_start = 2025,
art_coverage_decrease = FALSE,
art_interrupt_rate_increase = 0,
art_decr_start = 2025,
cumulative_years_list = c(9, 49),
summary_name = "costs"
)
#### plotting incidence at 2100 and HIV elimination year ####
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
library(gridExtra)
library(metR)
library(ggpubr)
library(ggfx)
library(RColorBrewer)
library(cowplot)
setwd("~/Documents/HIV_EndGame_SA/orderly/thembisa_orderly/src/thembisa")
source("R/cluster_function_orderly.R")
setwd("~/Documents/HIV_EndGame_SA/THEMBISAv18")
system("g++ -std=c++14 THEMBISA.cpp StatFunctions.cpp mersenne.cpp -o thembisa -O2")
run_on_cluster(pitc_reduction_years = 2025,
pitc_reduction_percentage = c(0, 25, 50, 75, 100),
condom_usage_reduction = FALSE,
condom_usage_decrease = 0,
condom_decr_start = 2025,
condom_usage_promotion = FALSE,
condom_usage_increase = 0,
condom_incr_start = 2025,
art_coverage_increase = FALSE,
art_interrupt_rate_decrease = 0,
art_incr_start = 2025,
art_coverage_decrease = FALSE,
art_interrupt_rate_increase = 0,
art_decr_start = 2025,
cumulative_years_list = c(9, 49),
summary_name = "costs"
)
cumulative_costs <- read_csv("results/cumulative_costs.csv")
cost_summary <- read_csv("results/costs.csv")
View(cumulative_costs)

# make long format pivoted df
outputs_df <- read_csv("outputs_df.csv")
View(df)
baseline_only <- df %>%
filter(scenario == "baseline")
intervention_only <- df %>%
filter(scenario == "intervention")
intervention_only$percent_change <- (baseline_only$value / intervention_only$value) * 100
View(intervention_only)
# Plots the outputs over time
plot_outputs <- function(df = df, output_name, title_of_plot = output_name, value=value) {
df %>%
filter(
indicator == output_name,
years >= 2020
) %>%
ggplot(aes(years, value, color = scenario)) +
geom_line() + ggtitle(title_of_plot) +
facet_wrap(~intervention_year) + expand_limits(y=0) + theme_bw() -> plot
return(plot)
}
plot_outputs(df = intervention_only, output_names[1], value = percent_change)
intervention_only %>%
filter(
indicator == output_names[1],
years >= 2020
) %>%
ggplot(aes(years, percent_change)) +
geom_line() + ggtitle(output_names[1]) +
facet_wrap(~intervention_year) + expand_limits(y=0) + theme_bw()
intervention_only$percent_change <-
(intervention_only$value / baseline_only$value) * 100
intervention_only %>%
filter(
indicator == output_names[1],
years >= 2020
) %>%
ggplot(aes(years, percent_change)) +
geom_line() + ggtitle(output_names[1]) +
facet_wrap(~intervention_year) + expand_limits(y=0) + theme_bw()
plot_pct_trend <- function(df, output_name, title_of_plot = output_name,
percent_change = percent_change) {
intervention_only %>%
filter(
indicator == output_name,
years >= 2020
) %>%
ggplot(aes(years, percent_change)) +
geom_line() + ggtitle(title_of_plot) +
facet_wrap(~intervention_year) + expand_limits(y=0) + theme_bw()
}
plot_pct_trend <- function(df, output_name, title_of_plot = output_name,
percent_change = percent_change) {
intervention_only %>%
filter(
indicator == output_name,
years >= 2020
) %>%
ggplot(aes(years, percent_change)) +
geom_line() + ggtitle(title_of_plot) + ylab("Change from baseline (%)")
facet_wrap(~intervention_year) + expand_limits(y=0) + theme_bw()
}
plot_pct_trend(output_names[1])
plot_pct_trend(output_name = output_names[1])
output_names[1]
plot_pct_trend(df = intervention_only, output_name = output_names[1])
plot_pct_trend <- function(df=intervention_only, output_name, title_of_plot = output_name,
percent_change = percent_change) {
df %>%
filter(
indicator == output_name,
years >= 2020
) %>%
ggplot(aes(years, percent_change)) +
geom_line() + ggtitle(title_of_plot) + ylab("Change from baseline (%)") +
facet_wrap(~intervention_year) + expand_limits(y=0) + theme_bw()
}
plot_pct_trend(output_name = output_names[1])
plot_pct_trend(output_name = output_names[1], title_of_plot = "Total HIV tests")
for (i in 1:15){
plot_pct_trend(output_name = output_names[i])
}
plot_pct_trend(output_name = output_names[11])
plot_pct_trend(output_name = output_names[1])
plot_pct_trend(output_name = output_names[2])
plot_pct_trend(output_name = output_names[3])
plot_pct_trend(output_name = output_names[4])
plot_pct_trend(output_name = output_names[5])
plot_pct_trend(output_name = output_names[6])
plot_pct_trend(output_name = output_names[7])
plot_pct_trend(output_name = output_names[8])
plot_pct_trend(output_name = output_names[9])
plot_pct_trend(output_name = output_names[10])
plot_pct_trend(output_name = output_names[11])
plot_pct_trend(output_name = output_names[12])
plot_pct_trend(output_name = output_names[13])
plot_pct_trend(output_name = output_names[14])
plot_pct_trend(output_name = output_names[15])
plot_pct_trend(output_name = "TotalAIDSdeathsAdult")
plot_pct_trend(output_name = "TotalARTAdult")
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2025,
years <= 2025+20,
scenario == "baseline",
intervention_year == 2025
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs
# then baseline results from 2030 to 2050
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2030,
years <= 2030+20,
scenario == "baseline",
intervention_year == 2030
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_baseline_2030
# add that to the bottom of the cumulative outputs
cumulative_outputs <- add_row(as.data.frame(cumulative_outputs),
as.data.frame(cumulative_outputs_baseline_2030))
# baseline results from 2035 to 2055
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2035,
years <= 2035+20,
scenario == "baseline",
intervention_year == 2035
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_baseline_2035
# add that to the bottom of the cumulative outputs
cumulative_outputs <- add_row(as.data.frame(cumulative_outputs),
as.data.frame(cumulative_outputs_baseline_2035))
# baseline results from 2040 to 2060
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2040,
years <= 2040+20,
scenario == "baseline",
intervention_year == 2040
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_baseline_2040
# add that to the bottom of the cumulative outputs
cumulative_outputs <- add_row(as.data.frame(cumulative_outputs),
as.data.frame(cumulative_outputs_baseline_2040))
# baseline results from 2045 to 2065
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2045,
years <= 2045+20,
scenario == "baseline",
intervention_year == 2045
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_baseline_2045
# add that to the bottom of the cumulative outputs
cumulative_outputs <- add_row(as.data.frame(cumulative_outputs),
as.data.frame(cumulative_outputs_baseline_2045))
# baseline results from 2050 to 2070
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2050,
years <= 2050+20,
scenario == "baseline",
intervention_year == 2050
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_baseline_2050
# add that to the bottom of the cumulative outputs
cumulative_outputs <- add_row(as.data.frame(cumulative_outputs),
as.data.frame(cumulative_outputs_baseline_2050))
# make a new a new dataframe of the cumulative results of the 2025 intervention
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2025,
years <= 2025+20,
scenario == "intervention",
intervention_year == 2025
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_2025
# add that to the bottom of the baseline
cumulative_outputs <- add_row(as.data.frame(cumulative_outputs),
as.data.frame(cumulative_outputs_2025))
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2030,
years <= 2030+20,
scenario == "intervention",
intervention_year == 2030
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_2030
cumulative_outputs <- add_row(cumulative_outputs,
as.data.frame(cumulative_outputs_2030))
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2035,
years <= 2035+20,
scenario == "intervention",
intervention_year == 2035
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_2035
cumulative_outputs <- add_row(cumulative_outputs,
as.data.frame(cumulative_outputs_2035))
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2040,
years <= 2040+20,
scenario == "intervention",
intervention_year == 2040,
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_2040
cumulative_outputs <- add_row(cumulative_outputs,
as.data.frame(cumulative_outputs_2040))
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2045,
years <= 2045+20,
scenario == "intervention",
intervention_year == 2045
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_2045
cumulative_outputs <- add_row(cumulative_outputs,
as.data.frame(cumulative_outputs_2045))
df %>%
filter(intervention_year <= 2050) %>%
group_by(indicator, intervention_year, scenario) %>%
filter(
years >= 2050,
years <= 2050+20,
scenario == "intervention",
intervention_year == 2050
) %>%
summarise(cumulative = sum(value)) -> cumulative_outputs_2050
cumulative_outputs <- add_row(cumulative_outputs,
as.data.frame(cumulative_outputs_2050))
View(cumulative_outputs)
cumulative_baseline_only <- cumulative_outputs %>%
filter(scenario == "baseline")
cumulative_intervention_only <- cumulative_outputs %>%
filter(scenario == "intervention")
intervention_only$percent_change <-
(cumulative_intervention_only$value / cumulative_baseline_only$value) * 100
intervention_only$percent_change <-
(cumulative_intervention_only$cumulative / cumulative_baseline_only$cumulative) * 100
cumulative_intervention_only$percent_change <-
(cumulative_intervention_only$cumulative / cumulative_baseline_only$cumulative) * 100
View(cumulative_baseline_only)
View(cumulative_intervention_only)
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Change from baseline (%)")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
cumulative_intervention_only %>%
filter(indicator = "TotalNewHIV", indicator = "TotalAIDSdeathsAdult",
indicator = "LYlostAIDS") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
cumulative_intervention_only %>%
filter(indicator == "TotalNewHIV", indicator == "TotalAIDSdeathsAdult",
indicator == "LYlostAIDS") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
rlang::last_error()
cumulative_intervention_only %>%
filter(indicator == "TotalNewHIV", indicator == "TotalAIDSdeathsAdult",
indicator == "LYlostAIDS") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator, scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
cumulative_intervention_only %>%
filter(indicator == "TotalNewHIV", indicator == "TotalAIDSdeathsAdult",
indicator == "LYlostAIDS") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() #+
cumulative_intervention_only %>%
filter(indicator == "TotalNewHIV", indicator == "TotalAIDSdeathsAdult",
indicator == "LYlostAIDS") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator, scales = "free_y") + theme_bw() + xlab("Intervention Year") +
cumulative_intervention_only %>%
filter(indicator == "TotalNewHIV", indicator == "TotalAIDSdeathsAdult",
indicator == "LYlostAIDS") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator, scales = "free_y") + theme_bw() +
xlab("Intervention Year")
cumulative_intervention_only %>%
filter(indicator == "TotalNewHIV", indicator == "TotalAIDSdeathsAdult",
indicator == "LYlostAIDS") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator, scales = "free_y") + theme_bw() +
xlab("Intervention Year")
cumulative_intervention_only %>%
filter(indicator == "TotalNewHIV" & indicator == "TotalAIDSdeathsAdult" &
indicator == "LYlostAIDS") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator, scales = "free_y") + theme_bw() +
xlab("Intervention Year")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "NewDiagnosesPregnancy",
indicator != "Number1stHIVtestsPos", indicator != "RediagnosesPregnancy",
indicator!= "StartingART", indicator != "TotalHIVtests",
indicator != "TotANCtests") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "NewDiagnosesPregnancy",
indicator != "Number1stHIVtestsPos", indicator != "RediagnosesPregnancy",
indicator!= "StartingARTtot", indicator != "TotalHIVtests",
indicator != "TotANCtests") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
cumulative_intervention_only$percent_change <-
(cumulative_intervention_only$cumulative - cumulative_baseline_only$cumulative
/ cumulative_baseline_only$cumulative) * 100
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "NewDiagnosesPregnancy",
indicator != "Number1stHIVtestsPos", indicator != "RediagnosesPregnancy",
indicator!= "StartingARTtot", indicator != "TotalHIVtests",
indicator != "TotANCtests") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
cumulative_intervention_only$percent_change <-
((cumulative_intervention_only$cumulative - cumulative_baseline_only$cumulative)
/ cumulative_baseline_only$cumulative) * 100
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "NewDiagnosesPregnancy",
indicator != "Number1stHIVtestsPos", indicator != "RediagnosesPregnancy",
indicator!= "StartingARTtot", indicator != "TotalHIVtests",
indicator != "TotANCtests") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "NewDiagnosesPregnancy",
indicator != "Number1stHIVtestsPos", indicator != "RediagnosesPregnancy",
indicator!= "StartingARTtot", indicator != "TotalHIVtests",
indicator != "TotANCtests") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Change from baseline (%)")
intervention_only$percent_change <-
((intervention_only$value - baseline_only$value) / baseline_only$value) * 100
plot_pct_trend(output_name = output_names[1])
plot_pct_trend(output_name = output_names[2])
plot_pct_trend(output_name = output_names[3])
plot_pct_trend(output_name = output_names[4])
plot_pct_trend(output_name = output_names[5])
plot_pct_trend(output_name = output_names[6])
plot_pct_trend(output_name = output_names[7])
plot_pct_trend(output_name = output_names[8])
plot_pct_trend(output_name = output_names[9])
plot_pct_trend(output_name = output_names[10])
plot_pct_trend(output_name = output_names[11])
plot_pct_trend(output_name = output_names[12])
plot_pct_trend(output_name = output_names[13])
plot_pct_trend(output_name = output_names[14])
plot_pct_trend(output_name = output_names[15])
plot_pct_trend(output_name = "TotalAIDSdeathsAdult")
plot_pct_trend(output_name = "TotalARTAdult")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Percentage of baseline (%)")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "NewDiagnosesPregnancy",
indicator != "Number1stHIVtestsPos", indicator != "RediagnosesPregnancy",
indicator!= "StartingARTtot", indicator != "TotalHIVtests",
indicator != "TotANCtests") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Change from baseline (%)")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "TotalNewHIV",
indicator != "LYlostAIDS", indicator != "RediagnosesPregnancy",
indicator != "StartingARTtot", indicator != "TotalAIDSdeathsAdult") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Change from baseline (%)")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "TotalNewHIV",
indicator != "LYlostAIDS",
indicator != "StartingARTtot", indicator != "TotalAIDSdeathsAdult") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Change from baseline (%)")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "TotalNewHIV",
indicator != "LYlostAIDS", indicator != "TotalHIVtest",
indicator != "StartingARTtot", indicator != "TotalAIDSdeathsAdult") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Change from baseline (%)")
cumulative_intervention_only %>%
filter(indicator != "Prop1stHIVtestsPos", indicator != "DiagnosedHIV_M",
indicator !="DiagnosedHIV_F", indicator != "TotalHIV",
indicator != "AIDSdeathsAdultF", indicator != "AIDSdeathsAdultM",
indicator != "TotalART15M", indicator != "TotalART15F",
indicator != "TotalARTAdult", indicator != "TotalNewHIV",
indicator != "LYlostAIDS", indicator != "TotalHIVtests",
indicator != "TotalAIDSdeathsAdult") %>%
ggplot(aes(intervention_year, percent_change)) +
geom_point() +
facet_wrap(~indicator,scales = "free_y") + theme_bw() + xlab("Intervention Year") +
ylab("Change from baseline (%)")

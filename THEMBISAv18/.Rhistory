#### changing prep and mmc ####
library(dplyr)
library(tidyr)
library(readr)
library(ggplot2)
library(gridExtra)
library(gridExtra)
library(metR)
library(ggpubr)
library(ggfx)
library(RColorBrewer)
library(cowplot)
#### baseline ####
setwd("~/Documents/HIV_EndGame_SA/orderly/thembisa_orderly/src/thembisa")
source("R/cluster_function_orderly.R")
setwd("~/Documents/HIV_EndGame_SA/THEMBISAv18")
all_scenarios <- read_csv("results/prep_vmmc_scenarios.csv")
all_scenarios <- bind_rows(baseline_summary, prep_summary, prep_mmc_summary,
prep_mmc_condom28_summary, prep_mmc_condom23_summary,
art95_summary, prep_mmc_art95_summary)
all_scenarios <- all_scenarios %>%
mutate(modeled_scenario = factor(modeled_scenario,
levels = c("Status quo", "No PrEP", "No PrEP + No VMMC",
"No PrEP + No VMMC + Condom usage 28%",
"No PrEP + No VMMC + Condom usage 23%",
"95-95-95", "95-95-95 + No PrEP + No VMMC")))
#### individual scenario adult incidence ####
# No PrEP
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "HIVinc15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = "dotted") +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV incidence per 1000", labels =(function(l) {round(l*1e3,1)}), breaks = c(0, 0.001, 0.002, 0.003, 0.004, 0.005, 0.006, 0.007, 0.008),expand = c(0, 0)) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV incidence \n(per 1000; 15-49 years)")
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "HIVinc15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = "dotted") +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV incidence per 1000", labels =(function(l) {round(l*1e3,1)}), breaks = c(0, 0.001, 0.002, 0.003, 0.004, 0.005, 0.006, 0.007, 0.008),expand = c(0, 0)) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV incidence \n(per 1000; 15-49 years)")
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "Prev15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = "dotted") +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV incidence per 1000", labels =(function(l) {round(l*1e3,1)}), breaks = c(0, 0.001, 0.002, 0.003, 0.004, 0.005, 0.006, 0.007, 0.008),expand = c(0, 0)) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV incidence \n(per 1000; 15-49 years)")
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "Prev15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = "dotted") +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV prevalence (%)", labels =(function(l) {round(l*1e2,1)}), breaks = c(0, 0.001, 0.002, 0.003, 0.004, 0.005, 0.006, 0.007, 0.008),expand = c(0, 0)) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV prevalence (%) \n(15-49 years)")
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "Prev15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV prevalence (%)", labels =(function(l) {round(l*1e2,1)})) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV prevalence (%) \n(15-49 years)")
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "Prev15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV prevalence (%)", labels =(function(l) {round(l*1e2,1)})) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV prevalence (%) \n(15-49 years)")
ggsave(filename = "unaids_figures/Prev15to49_baseline.png", device = "png", units = "cm", height = 17, width = 20)
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "Prev15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo", "No PrEP")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV prevalence (%)", labels =(function(l) {round(l*1e2,1)})) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV prevalence (%) \n(15-49 years)")
ggsave(filename = "unaids_figures/Prev15to49_NoPrEP.png", device = "png", units = "cm", height = 17, width = 20)
View(all_scenarios)
View(all_scenarios)
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "Prev15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo", "No PrEP", "No PrEP + No VMMC")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV prevalence (%)", labels =(function(l) {round(l*1e2,1)})) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV prevalence (%) \n(15-49 years)")
ggsave(filename = "unaids_figures/Prev15to49_NoPrEP.png", device = "png", units = "cm", height = 17, width = 20)
ggsave(filename = "unaids_figures/Prev15to49_NoPrEPNoVMMC.png", device = "png", units = "cm", height = 17, width = 20)
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "Prev15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV prevalence (%)", labels =(function(l) {round(l*1e2,1)})) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV prevalence (%) \n(15-49 years)")
ggsave(filename = "unaids_figures/Prev15to49_baseline.png", device = "png", units = "cm", height = 17, width = 20)
all_scenarios %>%
mutate(test_reduction = as.factor(test_reduction)) %>%
filter(pitc_reduction_year == 2025,
indicator == "Prev15to49",
year >= 2020,
test_reduction %in% c(0),
modeled_scenario %in% c("Status quo", "No PrEP", "No PrEP + No VMMC")
) %>%
ggplot(aes(year, mean, group = modeled_scenario, fill = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = modeled_scenario), show.legend = F) +
scale_x_continuous("", expand = c(0, 0)) +
expand_limits(y=0) + theme_classic() +
theme(axis.text = element_text(size = 16),
axis.title.y = element_blank(),
axis.title.x = element_text(size = 16),
legend.text = element_text(size = 16),
plot.title = element_text(size = 18, face = "bold", hjust = 0.5),
aspect.ratio=1,
legend.title = element_text(size = 11)) +
scale_y_continuous("HIV prevalence (%)", labels =(function(l) {round(l*1e2,1)})) +
scale_fill_brewer("", labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"),aesthetics = c("colour", "fill"), palette = "Set1") +
ggtitle("HIV prevalence (%) \n(15-49 years)")
ggsave(filename = "unaids_figures/Prev15to49_NoPrEPNoVMMC.png", device = "png", units = "cm", height = 17, width = 20)
0.03198752 * 100

"Incidence:Prevalence ratio", "New HIV infections", "Total living with HIV")
groups <- rep(c("15-49 years", "15+ years"), length(names) / 2)
names(groups) <- names
types <- rep(ylabs, each = 2)
names(types) <- names
View(all_scenarios)
all_scenarios <- bind_rows(baseline_summary, prep_summary, prep_mmc_summary,
prep_mmc_condom28_summary, prep_mmc_condom23_summary,
art95_summary, prep_mmc_art95_summary)
all_scenarios <- all_scenarios %>%
mutate(modeled_scenario = factor(modeled_scenario,
levels = c("Status quo", "No PrEP", "No PrEP + No VMMC",
"No PrEP + No VMMC + Condom usage 28%",
"No PrEP + No VMMC + Condom usage 23%",
"95-95-95", "95-95-95 + No PrEP + No VMMC")))
write_csv(all_scenarios, "results/prep_vmmc_scenarios.csv")
all_scenarios <- read_csv("results/prep_vmmc_scenarios.csv")
all_scenarios <- all_scenarios %>%
mutate(modeled_scenario = factor(modeled_scenario,
levels = c("Status quo", "No PrEP", "No PrEP + No VMMC",
"No PrEP + No VMMC + Condom usage 28%",
"No PrEP + No VMMC + Condom usage 23%",
"95-95-95", "95-95-95 + No PrEP + No VMMC")))
names <- c("ARTcoverage15to49", "ARTcoverageAdult", "HIVinc15to49",
"HIVinc15plus", "Prev15to49", "Prev15plus", "IncPrevRatio15to49", "IncPrevRatio15plus",
"NewAdultHIV", "NewHIV15to49", "TotHIV15to49", "TotHIV15", "Total15to49", "Total15plus")
ylabs <- c("ART coverage", "HIV incidence", "HIV prevalence",
"Incidence:Prevalence ratio", "New HIV infections", "Total living with HIV")
groups <- rep(c("15-49 years", "15+ years"), length(names) / 2)
names(groups) <- names
types <- rep(ylabs, each = 2)
names(types) <- names
ylabs <- c("ART coverage", "HIV incidence", "HIV prevalence",
"Incidence:Prevalence ratio", "New HIV infections", "Total living with HIV", "Total population")
groups <- rep(c("15-49 years", "15+ years"), length(names) / 2)
names(groups) <- names
types <- rep(ylabs, each = 2)
names(types) <- names
df <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:TotHIV15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
tidy_df <- df %>%
select(-c(scenario, pitc_reduction_year, test_reduction, discount, future_variability, future_value))
write_csv(tidy_df, "./results/inc_prev_adults.csv")
write_csv(tidy_df, "./results/inc_prev_adults_16Nov.csv")
ylabs <- c("ART coverage", "HIV incidence", "HIV prevalence",
"Incidence:Prevalence ratio", "New HIV infections", "Total living with HIV", "Total population")
write_csv(tidy_df, "./results/inc_prev_adults_thembisa4_5.csv")
ylabs <- c("ART coverage", "HIV incidence", "HIV prevalence",
"Incidence:Prevalence ratio", "New HIV infections", "Total living with HIV", "Total population")
groups <- rep(c("15-49 years", "15+ years"), length(names) / 2)
names(groups) <- names
types <- rep(ylabs, each = 2)
names(types) <- names
df2 <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
dplyr::mutate(across(contains("HIVinc15"), ~ . * 1e3),
across(contains("Prev15"), ~ . * 100),
across(contains("coverage"), ~ . * 100),
) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:Prev15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
df2 %>% filter(year >= 2020,
!modeled_scenario %in% c("95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1",
labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"))
sum(is.na(tidy_df))
tidy_df
names <- c("ARTcoverage15to49", "ARTcoverageAdult", "HIVinc15to49",
"HIVinc15plus", "Prev15to49", "Prev15plus", "IncPrevRatio15to49", "IncPrevRatio15plus",
"NewAdultHIV", "NewHIV15to49", "TotHIV15to49", "TotHIV15", "Total15to49", "Total15plus")
ylabs <- c("ART coverage", "HIV incidence", "HIV prevalence",
"Incidence:Prevalence ratio", "New HIV infections", "Total living with HIV", "Total population")
groups <- rep(c("15-49 years", "15+ years"), length(names) / 2)
names(groups) <- names
types <- rep(ylabs, each = 2)
names(types) <- names
df <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:TotHIV15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:TotHIV15to49, names_to = "indicator")
df <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:Total15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
tidy_df <- df %>%
select(-c(scenario, pitc_reduction_year, test_reduction, discount, future_variability, future_value))
sum(is.na(tidy_df))
write_csv(tidy_df, "./results/inc_prev_adults_thembisa4_5.csv")
#### transforming outputs based on types and groups to for easier plotting ####
names <- c("ARTcoverage15to49", "ARTcoverageAdult", "HIVinc15to49",
"HIVinc15plus", "Prev15to49", "Prev15plus", "IncPrevRatio15to49", "IncPrevRatio15plus",
"NewAdultHIV", "NewHIV15to49", "TotHIV15to49", "TotHIV15", "Total15to49", "Total15plus")
ylabs <- c("ART coverage", "HIV incidence", "HIV prevalence",
"Incidence:Prevalence ratio", "New HIV infections", "Total living with HIV", "Total population")
groups <- rep(c("15-49 years", "15+ years"), length(names) / 2)
names(groups) <- names
types <- rep(ylabs, each = 2)
names(types) <- names
df2 <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
dplyr::mutate(across(contains("HIVinc15"), ~ . * 1e3),
across(contains("Prev15"), ~ . * 100),
across(contains("coverage"), ~ . * 100),
) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:Total15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
df2 %>% filter(year >= 2020,
!modeled_scenario %in% c("95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1",
labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"))
ggsave(filename = "unaids_figures/adult_comparison1.png", device = "png", units = "cm", height = 32, width = 24)
df2 %>% filter(year >= 2020,
modeled_scenario %in% c("Status quo", "95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1")
ggsave(filename = "unaids_figures/adult_comparison2.png", device = "png", units = "cm", height = 32, width = 24)
View(df2)
1e6
10^6
df2 <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
dplyr::mutate(across(contains("HIVinc15"), ~ . * 1e3),
across(contains("Prev15"), ~ . * 100),
across(contains("coverage"), ~ . * 100),
across(contains("TotHIV"), ~ . /10^6),
across(contains("Total15"), ~ . /10^6)
) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:Total15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
df2 %>% filter(year >= 2020,
!modeled_scenario %in% c("95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1",
labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"))
ylabs <- c("ART coverage (%)", "HIV incidence per 1000", "HIV prevalence (%)",
"Incidence:Prevalence ratio", "New HIV infections (thousands)", "Total living with HIV (millions)", "Total population (millions)")
groups <- rep(c("15-49 years", "15+ years"), length(names) / 2)
names(groups) <- names
types <- rep(ylabs, each = 2)
names(types) <- names
df2 <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
dplyr::mutate(across(contains("HIVinc15"), ~ . * 1e3),
across(contains("Prev15"), ~ . * 100),
across(contains("coverage"), ~ . * 100),
across(contains("TotHIV"), ~ . /10^6),
across(contains("Total15"), ~ . /10^6),
across(contains("NewHIV"), ~ . /1000)
) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:Total15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
df2 %>% filter(year >= 2020,
!modeled_scenario %in% c("95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1",
labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"))
ggsave(filename = "unaids_figures/adult_comparison1.png", device = "png", units = "cm", height = 32, width = 24)
ggsave(filename = "unaids_figures/adult_comparison1.png", device = "png", units = "cm", height = 38, width = 24)
ylabs <- c("ART coverage\n(%)", "HIV incidence\nper 1000", "HIV prevalence\n(%)",
"Incidence:Prevalence\nratio", "New HIV infections\n(thousands)", "Total PLWH\n(millions)", "Total population\n(millions)")
groups <- rep(c("15-49 years", "15+ years"), length(names) / 2)
names(groups) <- names
types <- rep(ylabs, each = 2)
names(types) <- names
df2 <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
dplyr::mutate(across(contains("HIVinc15"), ~ . * 1e3),
across(contains("Prev15"), ~ . * 100),
across(contains("coverage"), ~ . * 100),
across(contains("TotHIV"), ~ . /10^6),
across(contains("Total15"), ~ . /10^6),
across(contains("NewHIV"), ~ . /1000)
) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:Total15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
df2 %>% filter(year >= 2020,
!modeled_scenario %in% c("95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1",
labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"))
ggsave(filename = "unaids_figures/adult_comparison1.png", device = "png", units = "cm", height = 38, width = 24)
View(tidy_df)
df2 <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
dplyr::mutate(across(contains("HIVinc15"), ~ . * 1e3),
across(contains("Prev15"), ~ . * 100),
across(contains("coverage"), ~ . * 100),
across(contains("TotHIV"), ~ . /10^6),
across(contains("Total15"), ~ . /10^6),
across(contains("New"), ~ . /1000)
) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:Total15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
df2 %>% filter(year >= 2020,
!modeled_scenario %in% c("95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1",
labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"))
ggsave(filename = "unaids_figures/adult_comparison1.png", device = "png", units = "cm", height = 38, width = 24)
df2 %>% filter(year >= 2020,
modeled_scenario %in% c("Status quo", "95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1")
ggsave(filename = "unaids_figures/adult_comparison2.png", device = "png", units = "cm", height = 32, width = 24)
ylabs <- c("ART coverage\n(%)", "HIV incidence\nper 1000", "HIV prevalence\n(%)",
"Inc:Prev\nratio", "New HIV infections\n(thousands)", "Total PLWH\n(millions)", "Total population\n(millions)")
groups <- rep(c("15-49 years", "15+ years"), length(names) / 2)
names(groups) <- names
types <- rep(ylabs, each = 2)
names(types) <- names
df2 <- all_scenarios %>%
dplyr::filter(indicator %in% names) %>%
tidyr::pivot_longer(cols = c(mean, upper_CI, lower_CI)) %>%
tidyr::pivot_wider(names_from = indicator) %>%
dplyr::mutate(across(contains("HIVinc15"), ~ . * 1e3),
across(contains("Prev15"), ~ . * 100),
across(contains("coverage"), ~ . * 100),
across(contains("TotHIV"), ~ . /10^6),
across(contains("Total15"), ~ . /10^6),
across(contains("New"), ~ . /1000)
) %>%
tidyr::pivot_longer(cols = ARTcoverage15to49:Total15to49, names_to = "indicator") %>%
tidyr::pivot_wider() %>%
dplyr::mutate(type = types[indicator],
group = groups[indicator])
df2 %>% filter(year >= 2020,
!modeled_scenario %in% c("95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1",
labels = c("Status quo", "No PrEP", "No PrEP + No VMMC", "No PrEP + No VMMC +\nCondom usage 28%","No PrEP + No VMMC +\nCondom usage 23%"))
ggsave(filename = "unaids_figures/adult_comparison1.png", device = "png", units = "cm", height = 38, width = 24)
df2 %>% filter(year >= 2020,
modeled_scenario %in% c("Status quo", "95-95-95", "95-95-95 + No PrEP + No VMMC")) %>%
ggplot(aes(x = year, group = modeled_scenario)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = modeled_scenario), alpha = 0.1) +
geom_line(aes(y = mean, col = modeled_scenario)) +
ggh4x::facet_grid2(vars(type), vars(group), scales = "free", independent = "x") + theme_bw() +
scale_x_continuous("", breaks = seq(2025, 2100, 25)) +
scale_y_continuous("") +
theme_classic() +
expand_limits(x = 2020, y = 0) +
theme(axis.text = element_text(size = 12),
axis.title.y = element_text(size = 12),
axis.title.x = element_text(size = 12),
legend.text = element_text(size = 12),
plot.title = element_text(size = 13, face = "bold", hjust = 0.5),
# aspect.ratio=1,
legend.title = element_blank(),
plot.margin = margin(r = 1.5, b = 2, unit = "cm"),
legend.position = "top",
# legend.position = c(0.58,-0.05),
legend.direction = "horizontal",
strip.placement = "outside",
strip.text.y = element_text(size = 13, face = "bold"),
strip.text.x = element_text(size = 13, face = "bold", angle = 0),
# strip.background = element_blank()
) +
scale_fill_brewer("",aesthetics = c("colour", "fill"), palette = "Set1")
ggsave(filename = "unaids_figures/adult_comparison2.png", device = "png", units = "cm", height = 32, width = 24)
ggsave(filename = "unaids_figures/adult_comparison2.png", device = "png", units = "cm", height = 38, width = 24)

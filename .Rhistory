<<<<<<< HEAD
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 1.00 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
View(baseline)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
=======
install.packages("sp")
Yes
library(INLA)
library(maptools)
library(rgdal)
library(fields)
install.packages("arm")
library(splancs)
library(lattice)
install.packages("gstat")
library(spdep)
library(abind)
here()
library(here)
i_am()
here()
getwd()
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
i_am("HIV_EndGame_SA")
source(here("scripts/modify_rollout.R"))
setwd("/Users/stefan/Documents/HIV_EndGame_SA")
source(here("scripts/modify_rollout.R"))
library(here)
here()
here:i_am("/Documents/HIV_EndGame_SA")
here:i_am("~/Documents/HIV_EndGame_SA")
setwd("/Users/stefan/Documents/HIV_EndGame_SA")
library(here)
here()
library(here)
here()
source(here("Documents/HIV_EndGame_SA/scripts/modify_rollout.R"))
setwd("/Users/stefan/Documents/HIV_EndGame_SA")
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
here()
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
source(here("R/art_interuption_fxns.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"LYlostAIDS",
"AIDSdeathsAdultM", "AIDSdeathsAdultF",
"DiagnosedHIV_M", "DiagnosedHIV_F",
"Number1stHIVtestsPos", "StartingARTtot", "Prop1stHIVtestsPos",
"NewDiagnosesPregnancy", "TotalART15F", "TotalART15M",
"RediagnosesPregnancy", "TotANCtests", "VLsuppressed", "TotHIV15",
"ARTcoverageAdult")
### establish intervention years
intervention_years <- seq(2025, 2050, 5)
### proportion of base rate by which to reduce
base_rate_reduction = 0.25
### reduce art interuption rate to increase ART coverage
art_interuption_rate = 0.4
art_increase_year = 2050
reduce_art_interuption(0.40, 2050)
### run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
### save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
### for loop that changes testing rate at different years and saves outputs
>>>>>>> reduce_ART_interuption
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
<<<<<<< HEAD
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# calculate percentage from baseline for trends
df <- df %>%
pivot_wider(names_from = scenario) %>%
mutate(percent_change = ((intervention - baseline)/baseline)*100) %>%
pivot_longer(-(intervention_year:indicator), names_to = "scenario")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty(output_names[1]) + ggtitle ("100% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_pct_chg_uncertainty(output_names[1]) + ggtitle("Total HIV tests in adults")
# testing
plot_outputs_with_uncertainty(output_names[1]) + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotProtSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
plot_outputs_with_uncertainty("CondomUsage")
plot_outputs_with_uncertainty("CondomUsage") +ylim(95,100)
plot_outputs_with_uncertainty("CondomUsage") +ylim(99,100)
plot_outputs_with_uncertainty("CondomUsage") +ylim(99.75,100)
View(baseline)
View(df)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
plot_outputs_with_uncertainty("CondomUsage")
View(dictionary)
run_thembisa_scenario <- function(intervention_year, output_names, base_rate_reduction){
## read in input parameter file
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
## write unedited input parameter file
formatted_data <- format_data(data, dictionary)
if (!is.na(intervention_year)){
formatted_data <- edit_formatted_data_incremental("reduction_condom_st",
new_values = 1 * base_rate_reduction,
starting_year = intervention_year)
}
rollout <- convert_to_thembisa_format(formatted_data, data, dictionary)
write(rollout, here("THEMBISAv18/Rollout.txt"))
## compile and model
run_thembisa()
read_thembisa_scenario(output_names)
}
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
# calculate total aids-related deaths
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_outputs_with_uncertainty("CondomUsage")
View(df)
run_thembisa_scenario <- function(intervention_year, output_names, base_rate_reduction){
## read in input parameter file
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
## write unedited input parameter file
formatted_data <- format_data(data, dictionary)
if (!is.na(intervention_year)){
formatted_data <- edit_formatted_data_incremental("reduction_condom_fsw",
new_values = 1 * base_rate_reduction,
starting_year = intervention_year)
}
rollout <- convert_to_thembisa_format(formatted_data, data, dictionary)
write(rollout, here("THEMBISAv18/Rollout.txt"))
## compile and model
run_thembisa()
read_thembisa_scenario(output_names)
}
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_outputs_with_uncertainty("CondomUsage")
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("R/support_modify_inputs.R"))
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_outputs_with_uncertainty("CondomUsage")
#### Load packages/functions ####
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("R/support_modify_inputs.R"))
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
#### Make empty dataframe for outputs ####
# names of all the outputs of interest
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
# create empty folder for results
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
# calculate total aids-related deaths
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_outputs_with_uncertainty("CondomUsage")
run_thembisa_scenario <- function(intervention_year, output_names, base_rate_reduction){
## read in input parameter file
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
## write unedited input parameter file
formatted_data <- format_data(data, dictionary)
if (!is.na(intervention_year)){
formatted_data <- edit_formatted_data_incremental("reduction_condom_st",
new_values = 1 * base_rate_reduction,
starting_year = intervention_year)
}
rollout <- convert_to_thembisa_format(formatted_data, data, dictionary)
write(rollout, here("THEMBISAv18/Rollout.txt"))
## compile and model
run_thembisa()
read_thembisa_scenario(output_names)
}
read_thembisa_results <- function(intervention_years){
filepaths <- paste0("results/scenario_", intervention_years, ".csv")
temp <- lapply(filepaths, read.csv)
names(temp) <- intervention_years
baseline <- read.csv("results/baseline.csv")
bind_rows(temp, .id = "intervention_year") %>%
dplyr::rename(intervention = value) %>%
dplyr::left_join(baseline) %>%
dplyr::rename(baseline = value) %>%
tidyr::pivot_longer(c(intervention, baseline), names_to = "scenario")
}
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("R/support_modify_inputs.R"))
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_outputs_with_uncertainty("CondomUsage")
#### Load packages/functions ####
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("R/support_modify_inputs.R"))
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
#### Make empty dataframe for outputs ####
# names of all the outputs of interest
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
# create empty folder for results
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
# calculate total aids-related deaths
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_outputs_with_uncertainty("CondomUsage")
#### Load packages/functions ####
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("R/support_modify_inputs.R"))
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
#### Make empty dataframe for outputs ####
# names of all the outputs of interest
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
# create empty folder for results
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
# calculate total aids-related deaths
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_outputs_with_uncertainty("CondomUsage")
#### Load packages/functions ####
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("R/support_modify_inputs.R"))
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
#### Make empty dataframe for outputs ####
# names of all the outputs of interest
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
# create empty folder for results
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
# calculate total aids-related deaths
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_outputs_with_uncertainty("CondomUsage")
#### Load packages/functions ####
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("R/support_modify_inputs.R"))
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
#### Make empty dataframe for outputs ####
# names of all the outputs of interest
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
# create empty folder for results
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# run baseline model
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
# calculate total aids-related deaths
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/100_pct_red_df.csv", row.names = FALSE)
df <- read.csv("results/100_pct_red_df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
plot_outputs_with_uncertainty("CondomUsage")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction, 50% ST condom reduction") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("100% testing reduction") + ylab ("New HIV infections")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("0% testing reduction, 50% ST condom reduction") + ylab ("New HIV infections")
# aids-related deaths
plot_outputs_with_uncertainty("TotalAIDSdeathsadult") + ggtitle ("25% testing reduction") + ylab ("AIDS-related deaths")
# aids-related deaths
plot_outputs_with_uncertainty("TotalAIDSdeathsadult") + ggtitle ("0% testing reduction, 50% ST condom reduction") + ylab ("AIDS-related deaths")
=======
### make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
### testing
plot_outputs_with_uncertainty("ARTcoverageAdult") + ggtitle ("") + scale_y_continuous("Proportion of adults with HIV on ART")
plot_outputs_with_uncertainty(output_names[1]) + ggtitle ("") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"LYlostAIDS",
"AIDSdeathsAdultM", "AIDSdeathsAdultF",
"DiagnosedHIV_M", "DiagnosedHIV_F",
"Number1stHIVtestsPos", "StartingARTtot", "Prop1stHIVtestsPos",
"NewDiagnosesPregnancy", "TotalART15F", "TotalART15M",
"RediagnosesPregnancy", "TotANCtests", "VLsuppressed", "TotHIV15",
"ARTcoverageAdult")
dir.create("results", FALSE, TRUE)
### establish intervention years
intervention_years <- seq(2025, 2050, 5)
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"LYlostAIDS",
"AIDSdeathsAdultM", "AIDSdeathsAdultF",
"DiagnosedHIV_M", "DiagnosedHIV_F",
"Number1stHIVtestsPos", "StartingARTtot", "Prop1stHIVtestsPos",
"NewDiagnosesPregnancy", "TotalART15F", "TotalART15M",
"RediagnosesPregnancy", "TotANCtests", "VLsuppressed", "TotHIV15",
"ARTcoverageAdult")
dir.create("results", FALSE, TRUE)
### establish intervention years
intervention_years <- seq(2025, 2050, 5)
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
### save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
### for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
### proportion of base rate by which to reduce
base_rate_reduction = 0.25
baseline <- run_thembisa_scenario(NA, output_names, base_rate_reduction = base_rate_reduction)
### save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
### for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario(intervention_year, output_names, base_rate_reduction = base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
### make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
### testing
plot_outputs_with_uncertainty("ARTcoverageAdult") + ggtitle ("") + scale_y_continuous("Proportion of adults with HIV on ART")
plot_outputs_with_uncertainty(output_names[1]) + ggtitle ("") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
View(df)
plot_outputs_with_uncertainty(output_names[1]) + ggtitle ("") + scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
View(df)
>>>>>>> reduce_ART_interuption

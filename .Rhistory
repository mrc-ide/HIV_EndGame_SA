condom_usage_summary %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("") +
ylab("Number of HIV tests") +
facet_wrap(ncol = 2, vars(intervention_year)) +
expand_limits(y=0) + theme_classic() + theme(text = element_text(size = 12)) +
scale_color_discrete("Reduction of \nprevious year's \ncondom usage \nprobability (%)") +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_inc <- df %>% filter(
scenario == "intervention",
indicator == "HIVinc15to49",
year >= 1990) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025))
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 0)
View(condom_usage_inc)
condom_usage_inc %>%
mutate(intervention_year = as.factor(2025)) %>%
filter(intervention_year == 2025 , #2099 reduction is used as a baseline / no reduction
test_reduction == 20 | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("blue", "red")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
condom_usage_inc <- df %>% filter(
scenario == "intervention",
indicator == "HIVinc15to49",
year >= 1990) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025))
View(condom_usage_inc)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 0)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 10)
plot_hiv_inc_from_summary <- function(df, reduction_year, pitc_reduction){
df %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == reduction_year, #2099 reduction is used as a baseline / no reduction
test_reduction == pitc_reduction | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
# mutate(test_reduction = factor(test_reduction, levels = c(pitc_reduction, 0))) %>%
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
}
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 00)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 0)
plot_hiv_inc_from_summary <- function(df, reduction_year, pitc_reduction){
df %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == reduction_year, #2099 reduction is used as a baseline / no reduction
test_reduction == pitc_reduction | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
# mutate(test_reduction = factor(test_reduction, levels = c(pitc_reduction, 0))) %>%
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("blue")) +
scale_fill_manual(" ", values = c("blue")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
}
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 0)
condom_usage_summary %>%
filter(test_reduction == 0)
condom_usage_summary %>%
filter(test_reduction == 0) %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("") +
ylab("Number of HIV tests") +
facet_wrap(ncol = 2, vars(intervention_year)) +
expand_limits(y=0) + theme_classic() + theme(text = element_text(size = 12)) +
scale_color_discrete("Reduction of \nprevious year's \ncondom usage \nprobability (%)") +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(text = element_text(size = 12)) +
scale_color_discrete("Reduction of \nprevious year's \ncondom usage \nprobability (%)") +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(text = element_text(size = 12)) +
scale_color_discrete("Reduction of \nprevious year's \ncondom usage \nprobability (%)") +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(text = element_text(size = 12)) +
scale_color_discrete("Reduction of \nprevious year's \ncondom usage \nprobability (%)") +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(text = element_text(size = 12)) +
scale_color_manual(" ", levels("blue", "red")) +
scale_fill_manual(" ", levels("blue", "red")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(text = element_text(size = 12)) +
scale_color_manual(" ", values = c("blue", "red")) +
scale_fill_manual(" ", values = c("blue", "red")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(text = element_text(size = 12)) +
scale_color_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_color_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year), show.legend = F) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_color_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_color_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = T) +
geom_line(aes(colour = intervention_year)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_color_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
# condom usage
condom_usage_summary <- df %>% filter(
scenario == "intervention",
indicator == "CondomUsage",
year >= 1990) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025))
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = T) +
geom_line(aes(colour = intervention_year)) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_color_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year), F) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_color_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year), show.legend = F) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_color_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
condom_usage_summary %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(test_reduction == 0, intervention_year != 2050) %>%
ggplot(aes(year, mean, group = intervention_year, fill = intervention_year)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = intervention_year), show.legend = F) +
xlab("") +
ylab("Number of HIV tests") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_color_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("Sex acts that used condom (%)")
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 0)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 20)
df %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == reduction_year, #2099 reduction is used as a baseline / no reduction
test_reduction == pitc_reduction | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
# mutate(test_reduction = factor(test_reduction, levels = c(pitc_reduction, 0))) %>%
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("blue", "red")) +
scale_fill_manual(" ", values = c("blue", "red")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
plot_hiv_inc_from_summary <- function(df, reduction_year, pitc_reduction){
df %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == reduction_year, #2099 reduction is used as a baseline / no reduction
test_reduction == pitc_reduction | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
# mutate(test_reduction = factor(test_reduction, levels = c(pitc_reduction, 0))) %>%
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("blue", "red")) +
scale_fill_manual(" ", values = c("blue", "red")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
}
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 20)
df %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == reduction_year, #2099 reduction is used as a baseline / no reduction
test_reduction == pitc_reduction | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
mutate(test_reduction = factor(test_reduction, levels = c(pitc_reduction, 0))) %>%
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("blue", "red")) +
scale_fill_manual(" ", values = c("blue", "red")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
plot_hiv_inc_from_summary <- function(df, reduction_year, pitc_reduction){
df %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == reduction_year, #2099 reduction is used as a baseline / no reduction
test_reduction == pitc_reduction | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
mutate(test_reduction = factor(test_reduction, levels = c(pitc_reduction, 0))) %>%
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("blue", "red")) +
scale_fill_manual(" ", values = c("blue", "red")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
}
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 20)
plot_hiv_inc_from_summary <- function(df, reduction_year, pitc_reduction){
df %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == reduction_year, #2099 reduction is used as a baseline / no reduction
test_reduction == pitc_reduction | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
mutate(test_reduction = factor(test_reduction, levels = c(pitc_reduction, 0))) %>%
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("blue", "red")) +
scale_fill_manual(" ", values = c("blue", "red")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
}
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 20)
df %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == reduction_year, #2099 reduction is used as a baseline / no reduction
test_reduction == pitc_reduction | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
mutate(test_reduction = factor(test_reduction, levels = c(pitc_reduction, 0))) %>%
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
plot_hiv_inc_from_summary <- function(df, reduction_year, pitc_reduction){
df %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
filter(intervention_year == reduction_year, #2099 reduction is used as a baseline / no reduction
test_reduction == pitc_reduction | test_reduction == 0) %>% #pitc_reduction is used to show the percentage reduced - 100% = complete cessation
mutate(test_reduction = factor(test_reduction, levels = c(pitc_reduction, 0))) %>%
ggplot(aes(year, mean, group = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.25, show.legend = F) +
geom_line(aes(colour = test_reduction), show.legend = F) +
geom_hline(aes(yintercept = 0.001), lty = 2, colour = 1) +
xlab(" ") +
expand_limits(y=0) + theme_classic() + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_colour_manual(" ", values = c("red", "blue")) +
scale_fill_manual(" ", values = c("red", "blue")) +
scale_y_continuous("HIV incidence rate per 1000 (15-49y)",
labels = (function(l) {round(l*1e3,2)}),breaks = c(0, 0.0010, 0.0050, 0.010, 0.015, 0.020)) +
ggtitle("")
}
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 20)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 40)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 60)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 80)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2025, 100)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2050, 0)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2050, 20)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2050, 20)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2050, 40)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2050, 46)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2050, 60)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2050, 80)
# example plot
plot_hiv_inc_from_summary(condom_usage_inc, 2050, 100)
cumulative_values <- calc_all_cumulatives(intervention_years, 50)
cumulative_values <- cumulative_values %>%
pivot_wider(names_from = scenario, values_from = cumulative) %>%
mutate(percent_change = ((intervention - baseline)/baseline)*100) %>%
mutate(absolute_dif = intervention - baseline) %>%
pivot_longer(-(indicator:test_reduction), names_to = "scenario")
# Plotting cumulative HIV infections over 40 year
cumulative_values %>% filter(
scenario == "absolute_dif", indicator == "NewAdultHIV", intervention_year == 2025) %>%
group_by(indicator, intervention_year, test_reduction, scenario) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean)) +
geom_line(aes(), show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI), alpha = 0.10, show.legend = F) +
xlab("PITC reduction (%)") + scale_y_continuous("Additional HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
# facet_wrap(nrow = 1, vars(indicator), scales = "free_y",
#            labeller = labeller(indicator = c(
#              "TotalAIDSdeathsadult" = "AIDS-related mortality",
#              "TotalHIVtests" = "Total HIV tests",
#              "NewAdultHIV" = "New HIV infections",
#              "SWsexActs" = "FSW sex acts",
#              "SWsexActsProt" = "Protected FSW sex acts",
#              "TotProtSexActs" = "Total protected sex acts",
#              "TotSexActs" = "Total sex acts"
#            ))) +
expand_limits(y=0) + theme_classic() + ggtitle(" ") + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_fill_discrete("Condom usage \nreduction \nstart year") + scale_color_discrete("Condom usage \nreduction \nstart year")
df <- read.csv("results/condom_reduction_2030.csv") # this is read again so that test_reduction can be used as an integer
df$test_reduction <- 100 - as.integer(df$test_reduction)
cumulative_values <- calc_all_cumulatives(intervention_years, 50)
cumulative_values <- cumulative_values %>%
pivot_wider(names_from = scenario, values_from = cumulative) %>%
mutate(percent_change = ((intervention - baseline)/baseline)*100) %>%
mutate(absolute_dif = intervention - baseline) %>%
pivot_longer(-(indicator:test_reduction), names_to = "scenario")
# Plotting cumulative HIV infections over 40 year
cumulative_values %>% filter(
scenario == "absolute_dif", indicator == "NewAdultHIV", intervention_year == 2025) %>%
group_by(indicator, intervention_year, test_reduction, scenario) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean)) +
geom_line(aes(), show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI), alpha = 0.10, show.legend = F) +
xlab("PITC reduction (%)") + scale_y_continuous("Additional HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
# facet_wrap(nrow = 1, vars(indicator), scales = "free_y",
#            labeller = labeller(indicator = c(
#              "TotalAIDSdeathsadult" = "AIDS-related mortality",
#              "TotalHIVtests" = "Total HIV tests",
#              "NewAdultHIV" = "New HIV infections",
#              "SWsexActs" = "FSW sex acts",
#              "SWsexActsProt" = "Protected FSW sex acts",
#              "TotProtSexActs" = "Total protected sex acts",
#              "TotSexActs" = "Total sex acts"
#            ))) +
expand_limits(y=0) + theme_classic() + ggtitle(" ") + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_fill_discrete("Condom usage \nreduction \nstart year") + scale_color_discrete("Condom usage \nreduction \nstart year")
# Plotting cumulative HIV infections over 40 year
cumulative_values %>% filter(
scenario == "absolute_dif", indicator == "NewAdultHIV", intervention_year == 2050) %>%
group_by(indicator, intervention_year, test_reduction, scenario) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean)) +
geom_line(aes(), show.legend = F) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI), alpha = 0.10, show.legend = F) +
xlab("PITC reduction (%)") + scale_y_continuous("Additional HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
# facet_wrap(nrow = 1, vars(indicator), scales = "free_y",
#            labeller = labeller(indicator = c(
#              "TotalAIDSdeathsadult" = "AIDS-related mortality",
#              "TotalHIVtests" = "Total HIV tests",
#              "NewAdultHIV" = "New HIV infections",
#              "SWsexActs" = "FSW sex acts",
#              "SWsexActsProt" = "Protected FSW sex acts",
#              "TotProtSexActs" = "Total protected sex acts",
#              "TotSexActs" = "Total sex acts"
#            ))) +
expand_limits(y=0) + theme_classic() + ggtitle(" ") + theme(axis.text = element_text(size = 14), axis.title.y = element_text(size = 14), axis.title.x = element_text(size = 14)) +
scale_fill_discrete("Condom usage \nreduction \nstart year") + scale_color_discrete("Condom usage \nreduction \nstart year")
View(calc_all_cumulatives)

output_names,
base_rate_reduction,
condom_incr_years)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction, 10% condom reduction") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, 1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, /n 1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, \nn 1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, \n 1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, \n1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("0% testing reduction, 10% condom reduction") +
ylab("Percentage of total sex acts that used condoms (%)")
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction, \n1% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035, \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("0% testing reduction, 10% condom reduction") +
ylab ("New HIV infections")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
ylab ("New HIV infections")
condom_usage_decrease = 0.005
condom_incr_years = seq(2025, 2070, 1)
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_decrease = NA,
output_names,
base_rate_reduction,
condom_incr_years)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2030, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
condom_usage_decrease = 0.005
# establish intervention years
intervention_years <- seq(2025, 2030, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
condom_usage_decrease = 0.005
condom_usage_init = 0.005
condom_incr_years = seq(2025, 2070, 1)
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init,
condom_usage_decrease = NA,
output_names,
base_rate_reduction,
condom_incr_years)
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init = condom_usage_init,
condom_usage_decrease = NA,
output_names = output_names,
base_rate_reduction = base_rate_reduction,
condom_incr_years =condom_incr_years)
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2030, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
condom_usage_decrease = 0.005
condom_usage_init = 0.005
condom_incr_years = seq(2025, 2070, 1)
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init = condom_usage_init,
condom_usage_decrease = NA,
output_names = output_names,
base_rate_reduction = base_rate_reduction,
condom_incr_years =condom_incr_years)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_init,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.5% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.5% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.5% condom reduction per year from 2025") +
ylab ("New HIV infections")
condom_usage_decrease = 0.0025 # this is amount that the condom usage decreases by each year
condom_usage_init = 0.0025 # this is the value of the first year's decrease
condom_incr_years = seq(2025, 2070, 1) # these are the year for which condom usage decreases
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init = condom_usage_init,
condom_usage_decrease = NA,
output_names = output_names,
base_rate_reduction = base_rate_reduction,
condom_incr_years =condom_incr_years)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_init,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.25% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.25% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.25% condom reduction per year from 2025") +
ylab ("New HIV infections")
View(dictionary)
formatted_data$data[,63]
formatted_data$data[,62]
formatted_data$data[,33]
formatted_data$data[,34]
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF", "ARTcoverageAdult")
dir.create("results", FALSE, TRUE)
# model input parameters
intervention_years <- seq(2025, 2030, 5) # establish years PITC changes occur
base_rate_reduction = 0.5 # proportion of PITC base rate
condom_usage_decrease = 0.0025 # this is amount that the condom usage decreases by each year
condom_usage_init = 0.0025 # this is the value of the first year's decrease
condom_incr_years = seq(2025, 2070, 1) # these are the year for which condom usage decreases
art_interrupt_incr = 0.0025 # this is amount that the condom usage decreases by each year
art_interrupt_init = 0.0025 # this is the value of the first year's decrease
art_incr_years = seq(2025, 2070, 1) # these are the year for which condom usage decreases
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
for (year in art_incr_years){
formatted_data2 <- edit_formatted_data(formatted_data2, "rel_rate_art_by_year",
new_values = (1-art_interrupt_incr),
starting_year = year)
art_interrupt_incr = art_interrupt_init + art_interrupt_incr
}
formatted_data$data[,34]
formatted_data2$data[,34]
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF", "ARTcoverageAdult")
dir.create("results", FALSE, TRUE)
# model input parameters
intervention_years <- seq(2025, 2030, 5) # establish years PITC changes occur
base_rate_reduction = 1 # proportion of PITC base rate
condom_usage_decrease = NA # this is amount that the condom usage decreases by each year
condom_usage_init = 0.0025 # this is the value of the first year's decrease
condom_incr_years = seq(2025, 2070, 1) # these are the year for which condom usage decreases
art_interrupt_incr = 0.0025 # this is amount that the art interruption rate decreases by each year
art_interrupt_init = 0.0025 # this is the value of the first year's art interruption rate decrease
art_incr_years = seq(2025, 2070, 1) # these are the year for which art interruption rate decreases
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init = condom_usage_init,
condom_usage_decrease = NA,
condom_incr_years = condom_incr_years,
art_interrupt_init = art_interrupt_init,
art_interrupt_incr = NA,
art_incr_years = art_incr_years,
output_names = output_names,
base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_init,
condom_usage_decrease,
condom_incr_years,
art_interrupt_init = art_interrupt_init,
art_interrupt_incr = NA,
art_incr_years = art_incr_years,
output_names,
base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("No testing reduction in 2025 or 2035 \n1% ART interruption rate reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# ART coverage
plot_outputs_with_uncertainty("ARTcoverageAdult") + ggtitle ("No testing reduction in 2025 or 2035 \n1% ART interruption rate reduction per year from 2025") +
ylab("Adult ART coverage(%)")
formatted_data2 <- reduce_art_interruption_incremental(output_names,
art_interrupt_init,
art_interrupt_incr,
art_incr_years)
formatted_data[,33]
formatted_data$data[,33]
formatted_data$data[,34]
art_interrupt_incr = 0.0025 # this is amount that the art interruption rate decreases by each year
art_interrupt_init = 0.0025 # this is the value of the first year's art interruption rate decrease
art_incr_years = seq(2025, 2070, 1) #
art_interrupt_incr = 0.01 # this is amount that the art interruption rate decreases by each year
art_interrupt_init = 0.01 # this is the value of the first year's art interruption rate decrease
art_incr_years = seq(2025, 2070, 1) # these are the year for which art interruption rate decreases
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
for (year in art_incr_years){
formatted_data2 <- edit_formatted_data(formatted_data2, "rel_rate_art_by_year",
new_values = (1-art_interrupt_incr),
starting_year = year)
art_interrupt_incr = art_interrupt_init + art_interrupt_incr
}
formatted_data2$data[,34]
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
art_interrupt_incr = 0.01 # this is amount that the art interruption rate decreases by each year
art_interrupt_init = 0.01 # this is the value of the first year's art interruption rate decrease
art_incr_years = seq(2025, 2070, 1) # these are the year for which art interruption rate decreases
if (!is.na(art_interrupt_incr)){
formatted_data2 <- reduce_art_interruption_incremental(output_names,
art_interrupt_init,
art_interrupt_incr,
art_incr_years)
}
formatted_data2$data[,34]
if (!is.na(condom_usage_decrease)){
formatted_data2 <- reduce_condom_usage_incremental(output_names,
condom_usage_init,
condom_usage_decrease,
condom_incr_years)
}
formatted_data2$data[,34]
if (!is.na(intervention_year)){
formatted_data2 <- edit_formatted_data_incremental(formatted_data2,
"rate_first_test_neg_fem_under_25",
new_values = 0.2877 * base_rate_reduction,
starting_year = intervention_year)
}
formatted_data2$data[,34]
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_init,
condom_usage_decrease,
condom_incr_years,
art_interrupt_init = art_interrupt_init,
art_interrupt_incr = art_interrupt_incr,
art_incr_years = art_incr_years,
output_names,
base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("No testing reduction in 2025 or 2035 \n1% ART interruption rate reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# ART coverage
plot_outputs_with_uncertainty("ARTcoverageAdult") + ggtitle ("No testing reduction in 2025 or 2035 \n1% ART interruption rate reduction per year from 2025") +
ylab("Adult ART coverage(%)")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("No testing reduction in 2025 or 2035 \n1% ART interruption rate reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# ART coverage
plot_outputs_with_uncertainty("ARTcoverageAdult") + ggtitle ("No testing reduction in 2025 or 2035 \n1% ART interruption rate reduction per year from 2025") +
ylab("Popportion of adults with HIV on ART")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.25% condom reduction per year from 2025") +
ylab ("New HIV infections")
df %>% filter(indicator == "ARTcoverageAdult", years == 2030)
View(df)
df %>% filter(indicator == "ARTcoverageAdult", year == 2030)
df %>% filter(indicator == "ARTcoverageAdult", year == 2030, intervention_year == 2025, scenario == "intervention")
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF", "ARTcoverageAdult")
dir.create("results", FALSE, TRUE)
# model input parameters
intervention_years <- seq(2025, 2030, 5) # establish years PITC changes occur
base_rate_reduction = 0.5 # proportion of PITC base rate
condom_usage_decrease = NA # this is amount that the condom usage decreases by each year
condom_usage_init = 0.0025 # this is the value of the first year's decrease
condom_incr_years = seq(2025, 2070, 1) # these are the year for which condom usage decreases
art_interrupt_incr = 0.01 # this is amount that the art interruption rate decreases by each year
art_interrupt_init = 0.01 # this is the value of the first year's art interruption rate decrease
art_incr_years = seq(2025, 2070, 1) # these are the year for which art interruption rate decreases
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init = condom_usage_init,
condom_usage_decrease = NA,
condom_incr_years = condom_incr_years,
art_interrupt_init = art_interrupt_init,
art_interrupt_incr = NA,
art_incr_years = art_incr_years,
output_names = output_names,
base_rate_reduction = base_rate_reduction)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_init,
condom_usage_decrease,
condom_incr_years,
art_interrupt_init = art_interrupt_init,
art_interrupt_incr = art_interrupt_incr,
art_incr_years = art_incr_years,
output_names,
base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% ART interruption rate reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# ART coverage
plot_outputs_with_uncertainty("ARTcoverageAdult") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% ART interruption rate reduction per year from 2025") +
ylab("Popportion of adults with HIV on ART")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% ART interruption rate reduction per year from 2025") +
ylab ("New HIV infections")

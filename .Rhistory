formatted_data2 <- format_data(data, dictionary)
formatted_data2$data[,72]
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_fsw",
new_values = (1-condom_usage_decrease),
starting_year = year)
condom_usage_decrease <- 0.01
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_fsw",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2$data[,72]
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_st",
new_values = (1-condom_usage_decrease),
starting_year = year,
final_year = year+1)
formatted_data2$data[,72:74]
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_st",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2$data[,72:74]
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_lt",
new_values = 1-condom_usage_decrease,
starting_year = year+1)
ormatted_data2$data[,72:74]
formatted_data2$data[,72:74]
condom_usage_increase += 0.01
condom_usage_decrease = 0.01 + condom_usage_decrease
condom_usage_decrease
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_fsw",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_st",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_lt",
new_values = 1-condom_usage_decrease,
starting_year = year+1)
formatted_data2$data[,72:74]
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
for (year in condom_incr_years{
for (year in condom_incr_years){
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_fsw",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_st",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_lt",
new_values = 1-condom_usage_decrease,
starting_year = year+1)
condom_usage_decrease = 0.01 + condom_usage_decrease
}
for (year in condom_incr_years){
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_fsw",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_st",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_lt",
new_values = 1-condom_usage_decrease,
starting_year = year)
condom_usage_decrease = 0.01 + condom_usage_decrease
}
formatted_data2$data[,72:74]
condom_usage_decrease <- 0.01
for (year in condom_incr_years){
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_fsw",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_st",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_lt",
new_values = 1-condom_usage_decrease,
starting_year = year)
condom_usage_decrease = 0.01 + condom_usage_decrease
}
formatted_data2$data[,72:74]
reduce_condom_usage_incremental  <- function(output_names, condom_usage_decrease, condom_incr_years){
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
for (year in condom_incr_years){
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_fsw",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_st",
new_values = (1-condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_lt",
new_values = 1-condom_usage_decrease,
starting_year = year)
condom_usage_decrease = 0.01 + condom_usage_decrease
}
return(formatted_data2)
}
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
formatted_data2$data[,72:74]
formatted_data2 <- reduce_condom_usage_incremental(output_names, 0.01, condom_incr_years)
formatted_data2$data[,72:74]
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
formatted_data3 <- reduce_condom_usage_incremental(output_names,
condom_usage_decrease,
condom_incr_years)
formatted_data3 <- edit_formatted_data_incremental(formatted_data3,
"rate_first_test_neg_fem_under_25",
new_values = 0.2877 * base_rate_reduction,
starting_year = intervention_year)
formatted_data3$data[,72:74]
formatted_data3$data[,63]
formatted_data3$data[,64]
formatted_data3$data[,1]
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
# data2 <- readLines(here("THEMBISAv18/Rollout.txt"))
formatted_data3 <- edit_formatted_data_incremental(formatted_data3,
"rate_first_test_neg_fem_under_25",
new_values = 0.2877 * base_rate_reduction,
starting_year = intervention_year)
formatted_data3$data[,1]
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
condom_incr_years = seq(2025, 2070, 1)
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2050, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
condom_usage_decrease = 0.01
condom_incr_years = seq(2025, 2070, 1)
# run baseline model
baseline <- run_thembisa_scenario_future_variable(intervention_year = NA,
condom_usage_decrease = NA,
output_names,
base_rate_reduction,
condom_incr_years)
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_decrease = NA,
output_names,
base_rate_reduction,
condom_incr_years)
run_thembisa_scenario_future_variables <- function(intervention_year,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years){
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
if (!is.na(condom_usage_decrease)){
formatted_data2 <- reduce_condom_usage_incremental(output_names,
condom_usage_decrease,
condom_incr_years)
}
if (!is.na(intervention_year)){
formatted_data2 <- edit_formatted_data_incremental(formatted_data3,
"rate_first_test_neg_fem_under_25",
new_values = 0.2877 * base_rate_reduction,
starting_year = intervention_year)
}
rollout <- convert_to_thembisa_format(formatted_data2, data, dictionary)
write(rollout, here("THEMBISAv18/Rollout.txt"))
## compile and model
run_thembisa()
read_thembisa_scenario(output_names)
}
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_decrease = NA,
output_names,
base_rate_reduction,
condom_incr_years)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# establish intervention years
intervention_years <- seq(2025, 2030, 5)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year, output_names,
base_rate_reduction,
future_var_value = 90,
future_var_year = intervention_year)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
run_thembisa_scenario_future_variables <- function(intervention_year,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years){
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary)
if (!is.na(condom_usage_decrease)){
formatted_data2 <- reduce_condom_usage_incremental(output_names,
condom_usage_decrease,
condom_incr_years)
}
if (!is.na(intervention_year)){
formatted_data2 <- edit_formatted_data_incremental(formatted_data2,
"rate_first_test_neg_fem_under_25",
new_values = 0.2877 * base_rate_reduction,
starting_year = intervention_year)
}
rollout <- convert_to_thembisa_format(formatted_data2, data, dictionary)
write(rollout, here("THEMBISAv18/Rollout.txt"))
## compile and model
run_thembisa()
read_thembisa_scenario(output_names)
}
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("0% testing reduction, 10% condom reduction") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, 1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, /n 1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, \nn 1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, \n 1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, \n1% condom reduction per year from 2025 to 2070") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction, \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("0% testing reduction, 10% condom reduction") +
ylab("Percentage of total sex acts that used condoms (%)")
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction, \n1% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035, \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("0% testing reduction, 10% condom reduction") +
ylab ("New HIV infections")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
ylab ("New HIV infections")
condom_usage_decrease = 0.005
condom_incr_years = seq(2025, 2070, 1)
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_decrease = NA,
output_names,
base_rate_reduction,
condom_incr_years)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(here)
source(here("scripts/modify_rollout.R"))
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2030, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
condom_usage_decrease = 0.005
# establish intervention years
intervention_years <- seq(2025, 2030, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
condom_usage_decrease = 0.005
condom_usage_init = 0.005
condom_incr_years = seq(2025, 2070, 1)
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init,
condom_usage_decrease = NA,
output_names,
base_rate_reduction,
condom_incr_years)
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init = condom_usage_init,
condom_usage_decrease = NA,
output_names = output_names,
base_rate_reduction = base_rate_reduction,
condom_incr_years =condom_incr_years)
source(here("R/read_and_run.R"))
output_names <- c("TotalHIVtests", "NewAdultHIV",
"AIDSdeathsAdultM", "AIDSdeathsAdultF","TotSexActs",
"SWsexActs", "TotProtSexActs", "SWsexActsProt")
dir.create("results", FALSE, TRUE)
# establish intervention years
intervention_years <- seq(2025, 2030, 5)
#### 100% reduction ####
# proportion of base rate by which to reduce
base_rate_reduction = 0.5 # I want to test this with no changes to the testing rate first
condom_usage_decrease = 0.005
condom_usage_init = 0.005
condom_incr_years = seq(2025, 2070, 1)
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init = condom_usage_init,
condom_usage_decrease = NA,
output_names = output_names,
base_rate_reduction = base_rate_reduction,
condom_incr_years =condom_incr_years)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_init,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n1% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.5% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.5% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.5% condom reduction per year from 2025") +
ylab ("New HIV infections")
condom_usage_decrease = 0.0025 # this is amount that the condom usage decreases by each year
condom_usage_init = 0.0025 # this is the value of the first year's decrease
condom_incr_years = seq(2025, 2070, 1) # these are the year for which condom usage decreases
# run baseline model
baseline <- run_thembisa_scenario_future_variables(intervention_year = NA,
condom_usage_init = condom_usage_init,
condom_usage_decrease = NA,
output_names = output_names,
base_rate_reduction = base_rate_reduction,
condom_incr_years =condom_incr_years)
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (intervention_year in intervention_years){
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
condom_usage_init,
condom_usage_decrease,
output_names,
base_rate_reduction,
condom_incr_years)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, ".csv"),
row.names = FALSE)
}
# make a new data frame joining all results
df <- read_thembisa_results(intervention_years)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
# testing
plot_outputs_with_uncertainty("TotalHIVtests") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.25% condom reduction per year from 2025") +
scale_y_continuous("Number of HIV tests (millions)", breaks = c(0, 10e6, 20e6, 30e6), labels = c(0, 10, 20, 30))
# condom usage
plot_outputs_with_uncertainty("CondomUsage") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.25% condom reduction per year from 2025") +
ylab("Percentage of total sex acts that used condoms (%)")
# new hiv infections
plot_outputs_with_uncertainty("NewAdultHIV") + ggtitle ("50% testing reduction in 2025 or 2035 \n0.25% condom reduction per year from 2025") +
ylab ("New HIV infections")

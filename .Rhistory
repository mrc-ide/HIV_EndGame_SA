st_condom_usage_init,
lt_condom_usage_init,
fsw_condom_usage_decrease,
st_condom_usage_decrease,
lt_condom_usage_decrease,
condom_incr_years){
data <- readLines(here("THEMBISAv18/Rollout_Original.txt"))
formatted_data2 <- format_data(data, dictionary) # reads in original value in editable format
for (year in condom_incr_years){ #loops over each condom usage increase year and changes the proportion reduction of probability
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_fsw",
new_values = (1-fsw_condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_st",
new_values = (1-st_condom_usage_decrease),
starting_year = year)
formatted_data2 <- edit_formatted_data(formatted_data2, "reduction_condom_lt",
new_values = (1-lt_condom_usage_decrease),
starting_year = year)
fsw_condom_usage_decrease = fsw_condom_usage_init + fsw_condom_usage_decrease
# if condition prevents negative values for probabilities
if (fsw_condom_usage_decrease >= 1){
fsw_condom_usage_decrease <- 1
}
st_condom_usage_decrease = st_condom_usage_init + st_condom_usage_decrease
if (st_condom_usage_decrease >= 1){
st_condom_usage_decrease <- 1
}
lt_condom_usage_decrease = lt_condom_usage_init + lt_condom_usage_decrease
if (lt_condom_usage_decrease >= 1){
lt_condom_usage_decrease <- 1
}
}
return(formatted_data2)
}
# save baseline outputs
write.csv(baseline, "results/baseline.csv", row.names = FALSE)
# for loop that changes testing rate at different years and saves outputs
for (percentage_value in sliding_scale_reduction){
st_condom_usage_init <- percentage_value/1000
lt_condom_usage_init <- percentage_value/1000
fsw_condom_usage_init <- percentage_value/1000
st_condom_usage_decrease <- percentage_value/1000
lt_condom_usage_decrease <- percentage_value/1000
fsw_condom_usage_decrease <- percentage_value/1000
for (intervention_year in intervention_years){
condom_incr_years <- seq(intervention_year, 2070, 1)
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
fsw_condom_usage_init = fsw_condom_usage_init,
st_condom_usage_init = st_condom_usage_init,
lt_condom_usage_init = lt_condom_usage_init,
fsw_condom_usage_decrease = fsw_condom_usage_decrease,
st_condom_usage_decrease = st_condom_usage_decrease,
lt_condom_usage_decrease = lt_condom_usage_decrease,
condom_incr_years = condom_incr_years,
art_interrupt_init = art_interrupt_init,
art_interrupt_incr = art_interrupt_incr,
art_incr_years = art_incr_years,
output_names,
base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, "_", percentage_value,".csv"),
row.names = FALSE)
}
}
# make a new data frame joining all results
df <- read_thembisa_results_sliding_scale(intervention_years, sliding_scale_reduction)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# calculate condom usage for total adults and fsw-client only
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
df$test_reduction <- as.integer(df$test_reduction)/10
df$test_reduction <- as.factor(df$test_reduction)
# testing
df %>% filter(
scenario == "intervention",
indicator == "TotalHIVtests",
year >= 2025) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("Years") +
ylab("Number of HIV tests") +
facet_wrap(vars(intervention_year)) + expand_limits(y=0) + theme_bw() + theme(text = element_text(size = 12)) +
scale_color_discrete("Annual \ncondom usage \nprobability \nreduction (%)") +
scale_y_continuous("Number of HIV tests (millions)", labels = (function(l) {round(l/1e6,1)}))
# condom usage
df %>% filter(
scenario == "intervention",
indicator == "CondomUsage",
year >= 2025) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("Years") +
ylab("Number of HIV tests") +
facet_wrap(ncol = 2, vars(intervention_year)) + expand_limits(y=0) + theme_bw() + theme(text = element_text(size = 12)) +
scale_color_discrete("Annual \ncondom usage \nprobability \nreduction (%)") +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
# for loop that changes testing rate at different years and saves outputs
for (percentage_value in sliding_scale_reduction){
st_condom_usage_init <- percentage_value/1000
lt_condom_usage_init <- percentage_value/1000
fsw_condom_usage_init <- percentage_value/1000
st_condom_usage_decrease <- percentage_value/1000
lt_condom_usage_decrease <- percentage_value/1000
fsw_condom_usage_decrease <- percentage_value/1000
for (intervention_year in intervention_years){
condom_incr_years <- seq(intervention_year, 2100, 1)
one_scenario <- run_thembisa_scenario_future_variables(intervention_year,
fsw_condom_usage_init = fsw_condom_usage_init,
st_condom_usage_init = st_condom_usage_init,
lt_condom_usage_init = lt_condom_usage_init,
fsw_condom_usage_decrease = fsw_condom_usage_decrease,
st_condom_usage_decrease = st_condom_usage_decrease,
lt_condom_usage_decrease = lt_condom_usage_decrease,
condom_incr_years = condom_incr_years,
art_interrupt_init = art_interrupt_init,
art_interrupt_incr = art_interrupt_incr,
art_incr_years = art_incr_years,
output_names,
base_rate_reduction)
write.csv(one_scenario, paste0("results/scenario_", intervention_year, "_", percentage_value,".csv"),
row.names = FALSE)
}
}
# make a new data frame joining all results
df <- read_thembisa_results_sliding_scale(intervention_years, sliding_scale_reduction)
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(TotalAIDSdeathsadult = AIDSdeathsAdultF + AIDSdeathsAdultM) %>%
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# calculate condom usage for total adults and fsw-client only
df <- df %>%
pivot_wider(names_from = indicator) %>%
mutate(CondomUsage = ((TotProtSexActs/TotSexActs)*100)) %>%
mutate(FSWCondomUsage = ((SWsexActsProt/SWsexActs)*100)) %>%
mutate(NonFSWCondomUsage = (((TotProtSexActs-SWsexActsProt)/(TotSexActs-SWsexActs))*100)) %>%
mutate(PctSexActsSW = ((SWsexActs/TotSexActs)*100)) %>%  # percentage of sex acts which are sex work
mutate(PctProtSexActsSW = ((SWsexActsProt/TotProtSexActs)*100)) %>%  # percentage of protected sex acts which are sex work
pivot_longer(-(intervention_year:scenario), names_to = "indicator")
# save results
write.csv(df, "results/df.csv", row.names = FALSE)
df <- read.csv("results/df.csv")
df$test_reduction <- as.integer(df$test_reduction)/10
df$test_reduction <- as.factor(df$test_reduction)
# testing
df %>% filter(
scenario == "intervention",
indicator == "TotalHIVtests",
year >= 2025) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("Years") +
ylab("Number of HIV tests") +
facet_wrap(vars(intervention_year)) + expand_limits(y=0) + theme_bw() + theme(text = element_text(size = 12)) +
scale_color_discrete("Annual \ncondom usage \nprobability \nreduction (%)") +
scale_y_continuous("Number of HIV tests (millions)", labels = (function(l) {round(l/1e6,1)}))
# condom usage
df %>% filter(
scenario == "intervention",
indicator == "CondomUsage",
year >= 2025) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("Years") +
ylab("Number of HIV tests") +
facet_wrap(ncol = 2, vars(intervention_year)) + expand_limits(y=0) + theme_bw() + theme(text = element_text(size = 12)) +
scale_color_discrete("Annual \ncondom usage \nprobability \nreduction (%)") +
scale_y_continuous("Percentage of total sex acts that used condom (%)")
df %>% filter(
scenario == "intervention",
indicator == "FSWCondomUsage",
year >= 2025) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("Years") +
ylab("Number of HIV tests") +
facet_wrap(vars(intervention_year)) + expand_limits(y=0) + theme_bw() + theme(text = element_text(size = 12)) +
scale_color_discrete("Annual \ncondom usage \nprobability \nreduction (%)") +
scale_y_continuous("Percentage of FSW sex acts that used condoms (%)")
df %>% filter(
scenario == "intervention",
indicator == "NonFSWCondomUsage",
year >= 2025) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("Years") +
ylab("Number of HIV tests") +
facet_wrap(vars(intervention_year)) + expand_limits(y=0) + theme_bw() + theme(text = element_text(size = 12)) +
scale_color_discrete("Annual \ncondom usage \nprobability \nreduction (%)") +
scale_y_continuous("Percentage of non-FSW sex acts that used condoms (%)")
df %>% filter(
scenario == "intervention",
indicator == "NewAdultHIV",
year >= 2025) %>%
group_by(year, intervention_year, test_reduction) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
ggplot(aes(year, mean, group = test_reduction, fill = test_reduction)) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = test_reduction), alpha = 0.10, show.legend = F) +
geom_line(aes(colour = test_reduction)) +
xlab("Years") +
ylab("Number of HIV tests") +
facet_wrap(ncol = 2, vars(intervention_year)) + expand_limits(y=0) + theme_bw() + theme(text = element_text(size = 12)) +
scale_color_discrete("Annual \ncondom usage \nprobability \nreduction (%)") +
scale_y_continuous("Number of new HIV infections")
df <- read.csv("results/df.csv") # this is read again so that test_reduction can be used as an integer
df$test_reduction <- as.integer(df$test_reduction)/10
# calculating cumulative values for different time scales
cumulative_years <- seq(20,50, 10)
for (cumulative_year in cumulative_years){
cumulative_values <- calc_all_cumulatives(intervention_years, cumulative_year)
write.csv(cumulative_values, paste0("results/cumulative_values_", cumulative_year,".csv"),
row.names = FALSE)
}
filepaths <- paste0("results/cumulative_values_", cumulative_years, ".csv")
temp <- lapply(filepaths, read.csv)
names(temp) <- cumulative_years
cumulative_values_all_years <- bind_rows(temp, .id = "cumulative_year")
# relative and absolute differences
cumulative_values_all_years <- cumulative_values_all_years %>%
pivot_wider(names_from = scenario, values_from = cumulative) %>%
mutate(percent_change = ((intervention - baseline)/baseline)*100) %>%
mutate(absolute_dif = intervention - baseline) %>%
pivot_longer(-(cumulative_year:test_reduction), names_to = "scenario")
# Cumulative New HIV infections - wrapped by cumulative years
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "NewAdultHIV") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = intervention_year)) +
geom_line(aes(color = intervention_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = T) +
xlab("PITC testing reduction (%)") + scale_y_continuous("Cumulative HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(cumulative_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Time scale for cumulative values") +
scale_fill_discrete("Test \nreduction \nyear") + scale_color_discrete("Test \nreduction \nyear")
# Cumulative New HIV infections - wrapped by cumulative years
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "NewAdultHIV") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = intervention_year)) +
geom_line(aes(color = intervention_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = T) +
xlab("Annual condom usage probability \nreduction (%)") + scale_y_continuous("Cumulative HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(cumulative_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Time scale for cumulative values") +
scale_fill_discrete("Test \nreduction \nyear") + scale_color_discrete("Test \nreduction \nyear")
# Cumulative HIV infections - wrapped by test reduction year
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "NewAdultHIV") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = cumulative_year)) +
geom_line(aes(color = cumulative_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = cumulative_year), alpha = 0.10, show.legend = T) +
xlab("PITC testing reduction (%)") + scale_y_continuous("Cumulative HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(intervention_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Test reduction year") +
scale_fill_discrete("Cumulative \nyears \nafter \nreduction") + scale_color_discrete("Cumulative \nyears \nafter \nreduction")
# Cumulative HIV infections - wrapped by test reduction year
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "NewAdultHIV") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = cumulative_year)) +
geom_line(aes(color = cumulative_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = cumulative_year), alpha = 0.10, show.legend = T) +
xlab("PITC testing reduction (%)") + scale_y_continuous("Cumulative HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(intervention_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Condom reduction start year") +
scale_fill_discrete("Cumulative \nyears \nafter \nreduction") + scale_color_discrete("Cumulative \nyears \nafter \nreduction")
Annual condom usage probability \nreduction (%)
# Cumulative New HIV infections - wrapped by cumulative years
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "NewAdultHIV") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = intervention_year)) +
geom_line(aes(color = intervention_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = T) +
xlab("Annual condom usage probability reduction (%)") + scale_y_continuous("Cumulative HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(cumulative_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Time scale for cumulative values") +
scale_fill_discrete("Test \nreduction \nyear") + scale_color_discrete("Test \nreduction \nyear")
# Cumulative New HIV infections - wrapped by cumulative years
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "NewAdultHIV") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = intervention_year)) +
geom_line(aes(color = intervention_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = T) +
xlab("Annual condom usage probability reduction (%)") + scale_y_continuous("Cumulative HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(cumulative_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Time scale for cumulative values") +
scale_fill_discrete("Condom \nusage \nreduction \nstart \nyear") + scale_color_discrete("Condom \nusage \nreduction \nstart \nyear")
# Cumulative New HIV infections - wrapped by cumulative years
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "NewAdultHIV") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = intervention_year)) +
geom_line(aes(color = intervention_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = T) +
xlab("Annual condom usage probability reduction (%)") + scale_y_continuous("Cumulative HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(cumulative_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Time scale for cumulative values") +
scale_fill_discrete("Condom \nusage \nreduction \nstart year") + scale_color_discrete("Condom \nusage \nreduction \nstart year")
# Cumulative HIV infections - wrapped by test reduction year
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "NewAdultHIV") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = cumulative_year)) +
geom_line(aes(color = cumulative_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = cumulative_year), alpha = 0.10, show.legend = T) +
xlab("PITC testing reduction (%)") + scale_y_continuous("Cumulative HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(intervention_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Condom reduction start year") +
scale_fill_discrete("Cumulative \nyears \nafter \nreduction") + scale_color_discrete("Cumulative \nyears \nafter \nreduction")
# Cumulative HIV infections - wrapped by test reduction year
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "NewAdultHIV") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = cumulative_year)) +
geom_line(aes(color = cumulative_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = cumulative_year), alpha = 0.10, show.legend = T) +
xlab("Annual condom usage probability reduction (%)") + scale_y_continuous("Cumulative HIV infections (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(intervention_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Condom reduction start year") +
scale_fill_discrete("Cumulative \nyears \nafter \nreduction") + scale_color_discrete("Cumulative \nyears \nafter \nreduction")
# Cumulative deaths - wrapped by cumulative years
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "TotalAIDSdeathsadult") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = intervention_year)) +
geom_line(aes(color = intervention_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = intervention_year), alpha = 0.10, show.legend = T) +
xlab("Annual condom usage probability reduction (%)") + scale_y_continuous("Cumulative AIDS-related deaths (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(cumulative_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Time scale for cumulative values") +
scale_fill_discrete("Condom \nusage \nreduction \nstart year") + scale_color_discrete("Condom \nusage \nreduction \nstart year")
# Cumulative deaths - wrapped by test reduction year
cumulative_values_all_years %>% filter(
scenario == "intervention", indicator == "TotalAIDSdeathsadult") %>%
group_by(indicator, intervention_year, test_reduction, scenario, cumulative_year) %>%
summarise(mean = mean(value), upper_CI = quantile(value, probs = 0.975),
lower_CI = quantile(value, probs = 0.025)) %>%
mutate(intervention_year = as.factor(intervention_year)) %>%
ggplot(aes(test_reduction, mean, fill = cumulative_year)) +
geom_line(aes(color = cumulative_year), show.legend = T) +
geom_ribbon(aes(ymin = lower_CI, ymax = upper_CI, fill = cumulative_year), alpha = 0.10, show.legend = T) +
xlab("Annual condom usage probability reduction (%)") + scale_y_continuous("Cumulative AIDS-related deaths (millions)", labels = (function(l) {round(l/1e6,1)}))  +
facet_wrap(vars(intervention_year), scales = "free_y",
labeller = labeller(indicator = c(
"TotalAIDSdeathsadult" = "AIDS-related mortality",
"TotalHIVtests" = "Total HIV tests",
"NewAdultHIV" = "New HIV infections",
"SWsexActs" = "FSW sex acts",
"SWsexActsProt" = "Protected FSW sex acts",
"TotProtSexActs" = "Total protected sex acts",
"TotSexActs" = "Total sex acts"
))) +
expand_limits(y=0) + theme_bw() + ggtitle("Condom reduction start year") +
scale_fill_discrete("Cumulative \nyears \nafter \nreduction") + scale_color_discrete("Cumulative \nyears \nafter \nreduction")
